<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rob OS</title>
    <!-- Regenerate icons from assets/icons/favicon.svg via node scripts/generate-icons.js -->
    <link rel="icon" href="./assets/icons/favicon.ico" sizes="any">
    <link rel="icon" type="image/svg+xml" href="./assets/icons/favicon.svg">
    <link rel="icon" type="image/png" sizes="32x32" href="./assets/icons/favicon-32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="./assets/icons/favicon-16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="./assets/icons/apple-touch-icon.png">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --ink: #e2e8f0;
            --ink-soft: #94a3b8;
            --muted: #94a3b8;
            --accent: #14b8a6;
            --accent-soft: rgba(20, 184, 166, 0.22);
            --icon-plate: rgba(15, 23, 42, 0.18);
            --icon-plate-border: rgba(148, 163, 184, 0.16);
            --icon-shadow: 0 6px 14px rgba(2, 6, 23, 0.22);
            --topbar-bg: rgba(15, 23, 42, 0.6);
            --topbar-border: rgba(148, 163, 184, 0.18);
            --bg-base: #313b4d;
            --bg-top: #3b465b;
            --bg-bottom: #2a3345;
            --bg-bloom-blue: rgba(96, 165, 250, 0.2);
            --bg-bloom-mint: rgba(20, 184, 166, 0.12);
            --grid-color: rgba(148, 163, 184, 0.02);
            --grain-opacity: 0.02;
            --grain-contrast: 110%;
            --surface: rgba(17, 24, 39, 0.94);
            --surface-2: rgba(24, 32, 48, 0.9);
            --surface-border: rgba(148, 163, 184, 0.2);
            --surface-shadow: 0 24px 60px rgba(0, 0, 0, 0.45);
            --overlay: rgba(2, 6, 23, 0.6);
            --icon-top: clamp(24px, 3.2vh, 32px);
            --icon-bottom-reserve: clamp(120px, 18vh, 180px);
            --parallax-x: 0px;
            --parallax-y: 0px;
        }

        html[data-theme="light"] {
            --ink: #111827;
            --ink-soft: #334155;
            --muted: #334155;
            --topbar-bg: rgba(248, 250, 252, 0.85);
            --topbar-border: rgba(100, 116, 139, 0.35);
            --bg-base: #f6f9fd;
            --bg-top: #eef3f9;
            --bg-bottom: #e6edf6;
            --bg-bloom-blue: rgba(59, 130, 246, 0.22);
            --bg-bloom-mint: rgba(20, 184, 166, 0.16);
            --grid-color: rgba(15, 23, 42, 0.05);
            --grain-opacity: 0.03;
            --grain-contrast: 104%;
            --surface: rgba(248, 250, 252, 0.98);
            --surface-2: rgba(241, 245, 249, 0.95);
            --surface-border: rgba(148, 163, 184, 0.4);
            --surface-shadow: 0 18px 36px rgba(15, 23, 42, 0.16);
            --overlay: rgba(15, 23, 42, 0.16);
            --icon-plate: rgba(255, 255, 255, 0.75);
            --icon-plate-border: rgba(100, 116, 139, 0.3);
            --icon-shadow: 0 8px 16px rgba(15, 23, 42, 0.14);
            --topbar-ink: #1f2937;
            --topbar-ink-soft: #334155;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Inter, sans-serif;
            background:
                radial-gradient(900px 650px at calc(78% + var(--parallax-x)) calc(20% + var(--parallax-y)), var(--bg-bloom-blue), transparent 58%),
                radial-gradient(780px 580px at calc(26% + var(--parallax-x)) calc(62% + var(--parallax-y)), var(--bg-bloom-mint), transparent 56%),
                radial-gradient(600px 420px at calc(52% + var(--parallax-x)) calc(42% + var(--parallax-y)), rgba(255, 255, 255, 0.04), transparent 60%),
                linear-gradient(155deg, var(--bg-top) 0%, var(--bg-base) 55%, var(--bg-bottom) 100%);
            color: var(--ink);
            overflow: hidden;
            height: 100vh;
        }

        body::before {
            content: "";
            position: fixed;
            inset: 0;
            pointer-events: none;
            opacity: 0.04;
            background-image:
                linear-gradient(to right, var(--grid-color) 1px, transparent 1px),
                linear-gradient(to bottom, var(--grid-color) 1px, transparent 1px);
            background-size: 24px 24px;
            z-index: 0;
        }

        html[data-theme="light"] body::before {
            opacity: 0.03;
            background-image:
                linear-gradient(120deg, rgba(59, 130, 246, 0.06) 0%, rgba(59, 130, 246, 0) 55%),
                linear-gradient(-120deg, rgba(20, 184, 166, 0.05) 0%, rgba(20, 184, 166, 0) 55%),
                linear-gradient(to right, var(--grid-color) 1px, transparent 1px),
                linear-gradient(to bottom, var(--grid-color) 1px, transparent 1px);
            background-size: 100% 100%, 100% 100%, 28px 28px, 28px 28px;
        }

        body::after {
            content: "";
            position: fixed;
            inset: 0;
            pointer-events: none;
            opacity: var(--grain-opacity);
            background-image:
                repeating-radial-gradient(circle at 20% 30%, rgba(0, 0, 0, 0.04) 0 1px, transparent 1px 3px),
                repeating-linear-gradient(120deg, rgba(0, 0, 0, 0.04) 0 1px, transparent 1px 4px);
            mix-blend-mode: multiply;
            filter: contrast(var(--grain-contrast));
            z-index: 0;
        }




        .topbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 52px;
            z-index: 999;
            display: flex;
            align-items: center;
            backdrop-filter: blur(10px);
            background: var(--topbar-bg);
            border-bottom: 1px solid var(--topbar-border);
            font-size: 13px;
            font-weight: 500;
            color: var(--ink-soft);
        }

        .topbar-inner {
            max-width: none;
            margin: 0;
            height: 52px;
            padding: 0 18px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
        }

        .topbar-left {
            display: flex;
            align-items: center;
            gap: 14px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 999px;
            background: var(--accent);
            box-shadow: 0 0 0 3px rgba(20, 184, 166, 0.15);
        }

        .brand-btn {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: transparent;
            border: 0;
            padding: 6px 8px;
            border-radius: 10px;
            color: var(--ink);
            cursor: pointer;
        }

        .brand-text {
            font-weight: 600;
            letter-spacing: -0.01em;
        }

        .chev {
            font-size: 10px;
            opacity: 0.7;
        }

        .topbar-right {
            display: flex;
            align-items: center;
            justify-content: flex-end;
            gap: 14px;
        }

        .icon-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 34px;
            height: 34px;
            border-radius: 10px;
            background: transparent;
            border: 0;
            color: var(--ink-soft);
            cursor: pointer;
            transition: color 0.15s ease, background 0.15s ease;
        }

        .weather-chip {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 6px 10px;
            border-radius: 999px;
            color: var(--ink-soft);
            border: 1px solid rgba(255, 255, 255, 0.08);
            background: rgba(0, 0, 0, 0.12);
            max-width: 220px;
        }

        .wx-icon {
            width: 18px;
            height: 18px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            color: var(--ink-soft);
        }

        #wxText {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .topbar-popover {
            position: absolute;
            top: 52px;
            left: 0;
            width: 260px;
            background: var(--surface);
            color: var(--ink);
            border: 1px solid var(--surface-border);
            border-radius: 12px;
            box-shadow: var(--surface-shadow);
            backdrop-filter: blur(14px);
            padding: 10px;
            z-index: 1200;
            display: none;
        }

        .topbar-popover.active {
            display: block;
        }

        .topbar-popover-title {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: var(--muted);
            margin-bottom: 6px;
        }

        .topbar-popover-text {
            font-size: 12px;
            color: var(--ink);
            margin-bottom: 10px;
        }

        .topbar-popover .open-cdir {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
            padding: 6px 10px;
            border-radius: 8px;
            border: 1px solid rgba(148, 163, 184, 0.2);
            background: transparent;
            color: var(--ink);
            cursor: pointer;
        }

        .topbar-popover .open-cdir:hover {
            background: rgba(20, 184, 166, 0.12);
            border-color: rgba(20, 184, 166, 0.3);
        }

        .clock {
            font-variant-numeric: tabular-nums;
            font-weight: 500;
            font-size: 13px;
            color: var(--ink-soft);
            letter-spacing: 0.04em;
        }

        .weather-icon {
            width: 18px;
            height: 18px;
        }

        .weather-anim .sun-core {
            animation: sunPulse 2.6s ease-in-out infinite;
            transform-origin: center;
        }

        .weather-anim.weather-cloudy,
        .weather-anim.weather-partly {
            animation: cloudDrift 6s ease-in-out infinite;
        }

        .weather-anim .drop {
            animation: rainFall 1.6s linear infinite;
        }

        .weather-anim .flake {
            animation: snowFall 2.2s linear infinite;
        }

        .weather-anim .bolt {
            animation: boltFlash 2.4s ease-in-out infinite;
        }

        @keyframes sunPulse {

            0%,
            100% {
                transform: scale(1);
                opacity: 0.9;
            }

            50% {
                transform: scale(1.08);
                opacity: 1;
            }
        }

        @keyframes cloudDrift {

            0%,
            100% {
                transform: translateX(0);
            }

            50% {
                transform: translateX(2px);
            }
        }

        @keyframes rainFall {
            0% {
                transform: translateY(0);
                opacity: 0.6;
            }

            100% {
                transform: translateY(3px);
                opacity: 0.2;
            }
        }

        @keyframes snowFall {
            0% {
                transform: translateY(0);
                opacity: 0.7;
            }

            100% {
                transform: translateY(2px);
                opacity: 0.3;
            }
        }

        @keyframes boltFlash {

            0%,
            85%,
            100% {
                opacity: 0.4;
            }

            90% {
                opacity: 1;
            }
        }

        @media (prefers-reduced-motion: reduce) {

            .weather-anim,
            .weather-anim * {
                animation: none !important;
            }
        }

        .icon-btn:hover {
            background: rgba(20, 184, 166, 0.12);
            color: var(--ink);
        }

        .icon-btn:focus-visible {
            outline: 2px solid rgba(20, 184, 166, 0.45);
            outline-offset: 2px;
        }

        .icon-btn.pulse {
            box-shadow: 0 0 0 0 rgba(20, 184, 166, 0.35);
            animation: togglePulse 1.4s ease-in-out infinite;
        }

        @keyframes togglePulse {
            0% {
                box-shadow: 0 0 0 0 rgba(20, 184, 166, 0.35);
            }

            70% {
                box-shadow: 0 0 0 8px rgba(20, 184, 166, 0);
            }

            100% {
                box-shadow: 0 0 0 0 rgba(20, 184, 166, 0);
            }
        }

        .toggle-hint {
            position: fixed;
            top: 52px;
            right: 160px;
            padding: 6px 10px;
            border-radius: 10px;
            background: rgba(17, 24, 39, 0.92);
            color: var(--ink);
            border: 1px solid rgba(148, 163, 184, 0.2);
            font-size: 11px;
            z-index: 1001;
            opacity: 0;
            transform: translateY(-4px);
            transition: opacity 0.2s ease, transform 0.2s ease;
            pointer-events: none;
        }

        .toggle-hint.show {
            opacity: 1;
            transform: translateY(0);
        }

        html[data-theme="light"] .toggle-hint {
            background: rgba(248, 250, 252, 0.95);
            color: var(--ink);
            border-color: rgba(148, 163, 184, 0.3);
        }

        .icon-btn svg {
            width: 18px;
            height: 18px;
        }


        .desktop {
            position: relative;
            z-index: 2;
            padding: 40px 48px;
            height: calc(100vh - 52px);
            overflow: visible;
        }

        .desktop::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 2px;
            height: 100%;
            background: linear-gradient(to bottom,
                    rgba(120, 180, 220, 0.35),
                    rgba(120, 180, 220, 0.05));
            pointer-events: none;
            z-index: 0;
        }

        .desktop::after {
            content: '';
            position: absolute;
            inset: 0;
            opacity: 0.05;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
            pointer-events: none;
            z-index: 1;
        }

        /* Updated grids for left/right split */
        /* Build Archive Grid */
        .build-archive-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            padding: 10px 0;
        }

        .archive-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 12px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.2, 0.8, 0.2, 1);
            text-decoration: none;
            display: block;
        }

        .archive-card:hover {
            transform: translateY(-2px);
            background: rgba(255, 255, 255, 0.06);
            border-color: rgba(255, 255, 255, 0.15);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
        }

        .archive-thumb {
            width: 100%;
            height: 140px;
            background: #1a1a1a;
            position: relative;
            overflow: hidden;
        }

        .archive-thumb img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.4s ease;
        }

        .archive-card:hover .archive-thumb img {
            transform: scale(1.05);
        }

        .archive-info {
            padding: 16px;
        }

        .archive-info h4 {
            margin: 0 0 6px 0;
            font-size: 15px;
            color: var(--ink);
            font-weight: 600;
        }

        .archive-info p {
            margin: 0;
            font-size: 13px;
            color: var(--ink-soft);
            line-height: 1.4;
        }

        /* Light mode overrides */
        [data-theme="light"] .archive-card {
            background: rgba(0, 0, 0, 0.02);
            border-color: rgba(0, 0, 0, 0.06);
        }

        [data-theme="light"] .archive-card:hover {
            background: rgba(0, 0, 0, 0.04);
            border-color: rgba(0, 0, 0, 0.1);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.08);
        }

        .icon-grid {
            position: fixed;
            top: 50px;
            padding: 8px 10px;
            display: grid;
            grid-template-columns: 92px !important;
            grid-auto-flow: row;
            width: 112px;
            grid-auto-rows: clamp(52px, 6.2vh, 64px);
            gap: 22px;
            z-index: 2;
            overflow: visible;
        }

        .icon-grid.left {
            left: 18px;
        }

        .icon-grid.right {
            left: 154px;
            right: auto;
        }

        @media (max-height: 760px) {
            /* Removed 2-column auto-flow as we are manually splitting columns now */
        }

        .icon-separator {
            display: none;
        }


        .desktop-icon {
            --app-accent: var(--ink);
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 92px;
            min-width: 64px;
            height: auto;
            padding: 0;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease, background 0.2s ease, border-color 0.2s ease;
            border: none;
            background: transparent;
            box-shadow: none;
            outline: none;
        }

        .desktop-icon:hover {
            background: transparent;
            box-shadow: none;
            transform: translateY(0);
            transition: all 0.16s ease;
        }

        .desktop-icon.selected {
            background: transparent;
            border: none;
            box-shadow: none;
        }

        .desktop-icon.selected .icon-glyph {
            box-shadow: none;
        }

        .desktop-icon:focus-visible {
            border-color: transparent;
            box-shadow: none;
        }

        .desktop-icon:focus-visible .icon-glyph {
            box-shadow: 0 0 0 2px rgba(20, 184, 166, 0.45);
        }

        .icon-glyph {
            width: 44px;
            height: 44px;
            border-radius: 0;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: transparent;
            box-shadow: none;
            border: none;
            transition: transform 0.16s ease, box-shadow 0.16s ease;
        }

        .icon-svg {
            width: 36px;
            height: 36px;
            stroke: currentColor;
            opacity: 0.95;
            stroke-width: 2;
            fill: none;
            transition: transform 0.16s ease;
            filter: drop-shadow(0 2px 6px rgba(0, 0, 0, 0.35));
            color: var(--app-accent);
        }

        .desktop-icon:hover .icon-glyph {
            transform: scale(1.06);
            box-shadow: none;
        }

        .desktop-icon:hover .icon-svg {
            filter: drop-shadow(0 3px 8px var(--app-accent));
        }

        .desktop-icon.selected .icon-svg {
            filter: drop-shadow(0 0 10px var(--app-accent));
        }

        .desktop-icon[data-id="microlifts"]:hover {
            box-shadow: none;
        }

        .icon-label {
            font-size: clamp(12px, 1.2vh, 13px);
            text-align: center;
            line-height: 1.25;
            color: var(--ink);
            font-weight: 400;
            text-shadow: 0 1px 2px rgba(2, 6, 23, 0.35);
            letter-spacing: -0.01em;
            width: 100%;
            max-width: 90px;
            white-space: normal;
            word-break: keep-all;
            text-wrap: balance;
            transition: color 0.16s ease;
            opacity: 0.85;
        }

        .desktop-icon:hover .icon-label {
            opacity: 1;
        }

        .icon-meta {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            width: 100%;
        }

        html[data-theme="light"] .icon-svg {
            filter: drop-shadow(0 2px 6px rgba(15, 23, 42, 0.2));
        }

        .desktop-icon.featured {
            border-color: transparent;
            background: transparent;
        }

        .desktop-icon.featured:hover {
            box-shadow: none;
        }

        html[data-theme="light"] .desktop-icon {
            background: transparent;
            border-color: transparent;
            box-shadow: none;
        }

        html[data-theme="light"] .desktop-icon.featured {
            background: transparent;
            border-color: transparent;
            box-shadow: none;
        }

        html[data-theme="light"] .desktop-icon:hover {
            background: transparent;
            border-color: transparent;
            box-shadow: none;
        }

        html[data-theme="light"] .desktop-icon.selected {
            background: transparent;
            border-color: transparent;
            box-shadow: none;
        }

        html[data-theme="light"] .icon-label {
            color: var(--ink);
            text-shadow: 0 1px 1px rgba(255, 255, 255, 0.7);
            opacity: 0.75;
        }

        html[data-theme="light"] .desktop-icon:hover .icon-label {
            opacity: 1;
        }

        @media (max-width: 768px) {
            .icon-glyph {
                width: 44px;
                height: 44px;
                border-radius: 0;
            }

            .icon-svg {
                width: 32px;
                height: 32px;
            }
        }

        .icon-desc {
            display: none;
            font-size: 12px;
            color: var(--muted);
            line-height: 1.4;
        }


        .theme-toggle {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            color: var(--ink-soft);
        }

        .theme-toggle input {
            accent-color: var(--accent);
        }


        .helper-tip {
            position: fixed;
            bottom: 24px;
            right: 24px;
            z-index: 100;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            padding: 12px 16px;
            border-radius: 8px;
            border: 0.5px solid rgba(143, 188, 212, 0.4);
            box-shadow: 0 12px 28px rgba(120, 110, 95, 0.18);
            font-size: 12px;
            color: var(--ink-soft);
            display: flex;
            align-items: center;
            gap: 12px;
            animation: slideInUp 0.4s ease-out;
        }

        .status-strip {
            position: fixed;
            left: 20px;
            bottom: 16px;
            z-index: 90;
            padding: 8px 12px;
            background: rgba(15, 23, 42, 0.45);
            border: 1px solid rgba(148, 163, 184, 0.35);
            border-radius: 10px;
            box-shadow: 0 10px 20px rgba(2, 6, 23, 0.3);
            font-size: 12px;
            color: var(--ink);
            max-width: 340px;
            backdrop-filter: blur(12px);
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            transition: background 0.2s ease, border-color 0.2s ease;
        }

        html[data-theme="light"] .status-strip {
            background: rgba(248, 250, 252, 0.95);
            border-color: rgba(100, 116, 139, 0.35);
            box-shadow: 0 10px 20px rgba(15, 23, 42, 0.14);
            color: var(--ink);
        }

        .status-glyph {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            border: 1px solid rgba(148, 163, 184, 0.5);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            color: var(--ink-soft);
            background: rgba(15, 23, 42, 0.4);
            flex-shrink: 0;
        }

        html[data-theme="light"] .status-glyph {
            background: rgba(148, 163, 184, 0.12);
        }

        .status-text {
            transition: opacity 0.18s ease, transform 0.18s ease;
            display: inline-block;
        }

        .status-text.updating {
            opacity: 0;
            transform: translateY(2px);
        }

        .status-strip.pulse {
            background: rgba(20, 184, 166, 0.18);
            border-color: rgba(20, 184, 166, 0.4);
        }

        @media (max-width: 768px) {
            .desktop {
                padding: 24px;
                height: auto;
                overflow: auto;
            }

            .desktop::before,
            .desktop::after {
                display: none;
            }

            .icon-grid {
                position: static;
                display: flex;
                flex-direction: column;
                gap: 18px;
                /* Reset right grid specific behavior on smaller screens */
                justify-items: start;
                right: auto;
                left: auto;
            }

            .icon-grid.right {
                margin-top: 18px;
            }

            .desktop-icon {
                width: 100%;
                height: auto;
                flex-direction: row;
                justify-content: flex-start;
                padding: 12px 14px;
                border-radius: 12px;
                background: rgba(255, 255, 255, 0.7);
                border: 1px solid rgba(148, 163, 184, 0.2);
            }

            .icon-svg {
                width: 28px;
                height: 28px;
                margin: 0 12px 0 0;
            }

            .icon-meta {
                align-items: flex-start;
            }

            .icon-label {
                font-size: 14px;
                text-align: left;
                color: var(--ink);
            }

            .icon-desc {
                display: block;
            }

            .status-strip {
                display: none;
            }
        }

        .helper-tip.hidden {
            display: none;
        }

        .helper-close {
            background: none;
            border: none;
            cursor: pointer;
            color: #475569;
            font-size: 16px;
            line-height: 1;
            padding: 0;
            margin-left: 4px;
            transition: color 0.15s;
        }

        .helper-close:hover {
            color: #111827;
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }


        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--overlay);
            backdrop-filter: blur(6px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.25s ease-out;
        }

        .modal-overlay.active {
            display: flex;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        @keyframes scaleIn {
            from {
                opacity: 0;
                transform: scale(0.96) translateY(-12px);
            }

            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        @keyframes scaleOut {
            from {
                opacity: 1;
                transform: scale(1) translateY(0);
            }

            to {
                opacity: 0;
                transform: scale(0.96) translateY(-8px);
            }
        }


        .modal-window {
            background: var(--surface);
            backdrop-filter: blur(10px);
            border: 0.5px solid var(--surface-border);
            border-radius: 14px;
            box-shadow: 0 18px 40px rgba(2, 6, 23, 0.28), inset 0 1px 0 rgba(255, 255, 255, 0.06);
            width: 90%;
            max-width: 620px;
            max-height: 85vh;
            display: flex;
            flex-direction: column;
            animation: scaleIn 0.18s cubic-bezier(0.4, 0, 0.2, 1);
            will-change: transform, opacity;
        }

        .modal-window.closing {
            animation: scaleOut 0.18s ease-in forwards;
        }

        .modal-overlay.closing {
            animation: fadeOut 0.18s ease-in forwards;
        }

        @keyframes fadeOut {
            from {
                opacity: 1;
            }

            to {
                opacity: 0;
            }
        }

        .context-menu {
            position: fixed;
            min-width: 0;
            max-width: 260px;
            background: rgba(17, 24, 39, 0.82);
            color: var(--ink);
            border: 1px solid rgba(148, 163, 184, 0.2);
            border-radius: 12px;
            box-shadow: 0 18px 36px rgba(2, 6, 23, 0.45);
            backdrop-filter: blur(14px);
            padding: 6px;
            z-index: 1200;
            display: none;
        }

        html[data-theme="light"] .context-menu {
            background: rgba(248, 250, 252, 0.95);
            color: var(--ink);
            border-color: rgba(100, 116, 139, 0.35);
            box-shadow: 0 18px 36px rgba(15, 23, 42, 0.22);
        }

        html[data-theme="light"] .topbar {
            color: var(--topbar-ink-soft);
            text-shadow: 0 1px 0 rgba(248, 250, 252, 0.9);
        }

        html[data-theme="light"] .brand-btn,
        html[data-theme="light"] .clock,
        html[data-theme="light"] .icon-btn,
        html[data-theme="light"] .weather-chip,
        html[data-theme="light"] .wx-icon {
            color: var(--topbar-ink-soft);
        }

        html[data-theme="light"] .icon-btn:hover {
            color: var(--topbar-ink);
            background: rgba(15, 23, 42, 0.06);
        }

        html[data-theme="light"] .weather-chip {
            background: rgba(255, 255, 255, 0.6);
            border-color: rgba(15, 23, 42, 0.12);
        }

        .context-menu.active {
            display: block;
        }

        .context-menu button {
            width: 100%;
            background: transparent;
            border: none;
            color: inherit;
            text-align: left;
            padding: 8px 10px;
            border-radius: 8px;
            font-size: 12px;
            cursor: pointer;
            transition: background 0.15s ease;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .context-menu button:hover {
            background: rgba(20, 184, 166, 0.18);
        }

        .context-divider {
            height: 1px;
            margin: 6px 4px;
            background: rgba(148, 163, 184, 0.18);
        }

        .context-section {
            padding: 6px 8px 2px;
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: var(--muted);
        }

        .selection-box {
            position: fixed;
            border: 1px solid rgba(20, 184, 166, 0.55);
            background: rgba(20, 184, 166, 0.12);
            border-radius: 6px;
            pointer-events: none;
            z-index: 900;
            opacity: 0;
            transition: opacity 0.12s ease;
        }

        .selection-box.active {
            opacity: 1;
        }

        .boot-toast {
            position: fixed;
            left: 20px;
            bottom: 56px;
            padding: 10px 12px;
            border-radius: 10px;
            background: rgba(17, 24, 39, 0.85);
            color: var(--ink);
            border: 1px solid rgba(148, 163, 184, 0.2);
            box-shadow: 0 10px 24px rgba(2, 6, 23, 0.4);
            font-size: 12px;
            line-height: 1.3;
            z-index: 950;
            opacity: 0;
            transform: translateY(8px);
            transition: opacity 0.2s ease, transform 0.2s ease;
        }

        .boot-toast.show {
            opacity: 1;
            transform: translateY(0);
        }

        html[data-theme="light"] .boot-toast {
            background: rgba(248, 250, 252, 0.95);
            color: var(--ink);
            border-color: rgba(148, 163, 184, 0.3);
            box-shadow: 0 10px 24px rgba(15, 23, 42, 0.15);
        }

        .preview-card {
            position: fixed;
            width: 220px;
            background: rgba(17, 24, 39, 0.92);
            color: var(--ink);
            border: 1px solid rgba(148, 163, 184, 0.2);
            border-radius: 12px;
            box-shadow: 0 18px 36px rgba(2, 6, 23, 0.45);
            backdrop-filter: blur(12px);
            padding: 10px;
            z-index: 1400;
            opacity: 0;
            transform: scale(0.98);
            pointer-events: none;
            transition: opacity 0.14s ease-out, transform 0.14s ease-out;
        }

        html[data-theme="light"] .preview-card {
            background: rgba(248, 250, 252, 0.95);
            color: var(--ink);
            border-color: rgba(100, 116, 139, 0.35);
            box-shadow: 0 18px 36px rgba(15, 23, 42, 0.22);
        }

        .preview-card.active {
            opacity: 1;
            transform: scale(1);
            pointer-events: auto;
        }

        .preview-label {
            font-size: 10px;
            color: var(--muted);
            text-transform: uppercase;
            letter-spacing: 0.08em;
            margin-bottom: 4px;
        }

        .preview-title {
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--ink);
        }

        .preview-media {
            position: relative;
            width: 100%;
            height: 120px;
            border-radius: 10px;
            overflow: hidden;
            background: rgba(148, 163, 184, 0.12);
            border: 1px solid rgba(148, 163, 184, 0.15);
            margin-bottom: 8px;
        }

        .preview-media img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .preview-media.loaded img {
            opacity: 1;
        }

        .preview-fallback {
            position: absolute;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            color: var(--ink-soft);
            padding: 10px;
            text-align: center;
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .preview-media.error .preview-fallback {
            opacity: 1;
        }

        .preview-skeleton {
            position: absolute;
            inset: 0;
            background: linear-gradient(90deg, rgba(148, 163, 184, 0.08), rgba(148, 163, 184, 0.18), rgba(148, 163, 184, 0.08));
            background-size: 200% 100%;
            animation: shimmer 1.4s ease-in-out infinite;
        }

        .preview-media.loaded .preview-skeleton {
            display: none;
        }

        .preview-media.error .preview-skeleton {
            display: none;
        }

        @keyframes shimmer {
            0% {
                background-position: 0% 0;
            }

            100% {
                background-position: -200% 0;
            }
        }

        .preview-actions {
            display: flex;
            gap: 8px;
        }

        .preview-action {
            flex: 1;
            font-size: 11px;
            padding: 6px 8px;
            border-radius: 8px;
            border: 1px solid rgba(148, 163, 184, 0.2);
            background: transparent;
            color: var(--ink);
            cursor: pointer;
            transition: background 0.12s ease, border-color 0.12s ease;
        }

        .preview-action:hover {
            background: rgba(20, 184, 166, 0.12);
            border-color: rgba(20, 184, 166, 0.3);
        }

        @media (prefers-reduced-motion: reduce) {

            .preview-card,
            .preview-media img,
            .preview-skeleton {
                transition: none;
                animation: none;
            }
        }

        .window-chrome {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 14px;
            border-bottom: 0.5px solid var(--surface-border);
            background: var(--surface-2);
            border-radius: 14px 14px 0 0;
        }

        .window-title-group {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            min-width: 0;
        }

        .window-icon {
            width: 16px;
            height: 16px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            color: var(--ink-soft);
        }

        .window-title {
            font-family: 'SF Mono', 'Consolas', monospace;
            font-size: 12px;
            font-weight: 600;
            color: var(--ink-soft);
            letter-spacing: 0.03em;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .close-button {
            width: 32px;
            height: 32px;
            background: transparent;
            border: 1px solid transparent;
            cursor: pointer;
            padding: 0;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.15s ease, box-shadow 0.15s ease, color 0.15s ease;
            color: var(--ink-soft);
        }

        .close-button:hover {
            background: rgba(20, 184, 166, 0.12);
            box-shadow: 0 0 10px rgba(20, 184, 166, 0.25);
            color: var(--ink);
        }

        .close-button svg {
            display: none;
        }

        .close-button::before {
            content: "";
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: rgba(148, 163, 184, 0.4);
        }

        .modal-content {
            padding: 20px;
            overflow-y: auto;
            flex: 1;
            line-height: 1.55;
        }

        .modal-footer {
            padding: 12px 20px;
            border-top: 0.5px solid var(--surface-border);
            background: var(--surface-2);
            border-radius: 0 0 12px 12px;
            font-size: 11px;
            color: var(--ink-soft);
            text-align: center;
        }


        .breadcrumb {
            font-size: 12px;
            color: var(--muted);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .breadcrumb-sep {
            color: var(--muted);
        }

        .content-section {
            margin-bottom: 16px;
        }

        .content-section:last-child {
            margin-bottom: 0;
        }

        .content-section h3 {
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.06em;
            color: var(--muted);
            margin-bottom: 8px;
        }

        .about-kicker {
            font-family: 'SF Mono', 'Consolas', monospace;
            font-size: 12px;
            color: var(--accent);
            margin-bottom: 12px;
        }

        .about-divider {
            border: none;
            border-top: 0.5px solid var(--surface-border);
            margin: 16px 0;
        }

        .about-highlight {
            color: var(--accent);
            font-weight: 600;
        }

        .about-txt {
            font-family: 'SF Mono', 'Consolas', monospace;
            font-size: 13px;
            color: var(--ink);
            line-height: 1.7;
        }

        .about-header {
            font-size: 12px;
            color: var(--ink-soft);
            margin-bottom: 16px;
            white-space: pre-wrap;
        }

        .about-label {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: var(--muted);
            margin-bottom: 6px;
            font-weight: 600;
        }

        .about-log {
            font-size: 12px;
            color: var(--ink-soft);
            line-height: 1.6;
        }

        .about-now {
            color: var(--ink);
        }

        .content-section p {
            color: var(--ink);
            margin-bottom: 10px;
            font-size: 14px;
        }

        .content-section ul {
            list-style: none;
        }

        .content-section li {
            display: flex;
            gap: 12px;
            margin-bottom: 10px;
            color: var(--ink);
            font-size: 14px;
        }

        .bullet {
            color: var(--muted);
            flex-shrink: 0;
            font-weight: 600;
        }

        .case-study-list {
            display: flex;
            flex-direction: column;
            gap: 14px;
        }

        .case-study-item {
            padding: 18px;
            border: 0.5px solid var(--surface-border);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            background: var(--surface-2);
        }

        .case-study-item:hover {
            border-color: rgba(20, 184, 166, 0.35);
            background: var(--surface);
            transform: translateY(-1px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        }

        .case-study-item h4 {
            font-size: 15px;
            margin-bottom: 6px;
            color: var(--ink);
            font-weight: 600;
        }

        .case-study-item p {
            font-size: 13px;
            color: var(--muted);
            margin: 0;
            line-height: 1.5;
        }

        .back-button {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            color: var(--ink);
            font-size: 13px;
            cursor: pointer;
            border: none;
            background: transparent;
            padding: 6px 0;
            margin-bottom: 20px;
            font-weight: 500;
            transition: opacity 0.15s;
        }

        .back-button:hover {
            opacity: 0.7;
        }

        .case-detail h3 {
            font-size: 22px;
            font-weight: 600;
            margin-bottom: 24px;
            text-transform: none;
            letter-spacing: -0.02em;
            color: var(--ink);
        }

        .tools {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .tool-tag {
            padding: 6px 12px;
            background: var(--surface-2);
            border: 0.5px solid var(--surface-border);
            border-radius: 6px;
            font-size: 12px;
            color: var(--muted);
            font-weight: 500;
        }

        .screenshots {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-top: 12px;
        }

        .screenshot-placeholder {
            aspect-ratio: 16/9;
            background: linear-gradient(135deg, var(--surface-2) 0%, var(--surface) 100%);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--muted);
            font-size: 12px;
            border: 0.5px solid var(--surface-border);
        }

        .contact-links {
            margin-bottom: 20px;
        }

        .contact-links a {
            color: var(--ink);
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            font-size: 15px;
            transition: opacity 0.15s;
        }

        .contact-links a:hover {
            opacity: 0.7;
        }

        .copy-button {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 6px 10px;
            background: rgba(15, 23, 42, 0.06);
            color: var(--ink);
            border: 0.5px solid rgba(15, 23, 42, 0.12);
            border-radius: 7px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            transition: all 0.15s;
            margin-top: 6px;
        }

        .copy-button:hover {
            background: rgba(15, 23, 42, 0.12);
        }

        .copy-button.copied {
            background: var(--ink);
            color: #ffffff;
            border-color: var(--ink);
        }

        .copy-toast {
            display: inline-block;
            margin-left: 10px;
            font-size: 11px;
            color: var(--ink-soft);
            opacity: 0;
            transform: translateY(2px);
            transition: opacity 0.2s ease, transform 0.2s ease;
        }

        .copy-toast.show {
            opacity: 1;
            transform: translateY(0);
        }

        .download-button {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            padding: 8px 14px;
            background: var(--surface-2);
            color: var(--ink);
            border: 1px solid var(--surface-border);
            border-radius: 8px;
            cursor: pointer;
            font-size: 12px;
            text-decoration: none;
            transition: all 0.2s;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(15, 23, 42, 0.12);
        }

        .download-button:hover {
            background: rgba(20, 184, 166, 0.12);
            transform: translateY(-1px);
            box-shadow: 0 6px 16px rgba(15, 23, 42, 0.18);
        }

        .divider {
            border: none;
            border-top: 0.5px solid var(--surface-border);
            margin: 24px 0;
        }

        .text-lg {
            font-size: 15px;
        }

        .external-icon {
            width: 14px;
            height: 14px;
        }

        .system-info-grid {
            display: grid;
            grid-template-columns: auto 1fr;
            gap: 12px 20px;
            font-size: 13px;
            font-family: 'SF Mono', 'Consolas', monospace;
        }

        .system-info-label {
            color: var(--muted);
            font-weight: 600;
        }

        .system-info-value {
            color: var(--ink);
        }

        .diagnostics-content {
            font-family: 'SF Mono', 'Consolas', monospace;
            font-size: 11px;
        }

        .diagnostics-event {
            padding: 8px;
            background: var(--surface-2);
            border-radius: 6px;
            margin-bottom: 6px;
            border: 0.5px solid var(--surface-border);
        }

        .diagnostics-event-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 4px;
            color: var(--muted);
        }

        .diagnostics-event-name {
            color: var(--ink);
            font-weight: 600;
        }

        .diagnostics-event-details {
            color: var(--ink);
            font-size: 10px;
        }

        /* --- Mobile Shell Styles --- */
        .mobile-shell {
            display: none;
        }

        @media (max-width: 640px) {
            .desktop-shell {
                display: none !important;
            }

            .mobile-shell {
                display: flex;
                flex-direction: column;
                height: 100vh;
                height: 100dvh;
                width: 100%;
                overflow: hidden;
                position: relative;
                padding-top: env(safe-area-inset-top);
                padding-bottom: env(safe-area-inset-bottom);
                background-size: cover;
                background-position: center;
            }

            .mobile-status-bar {
                height: 44px;
                padding: 0 24px;
                display: flex;
                align-items: center;
                justify-content: space-between;
                font-size: 14px;
                font-weight: 600;
                color: var(--ink);
                z-index: 10;
            }

            .mobile-status-right {
                display: flex;
                gap: 6px;
                align-items: center;
            }

            .mobile-header {
                margin-top: 12px;
                text-align: center;
                color: var(--ink);
                opacity: 0.85;
                font-weight: 500;
                letter-spacing: 0.01em;
            }

            .mobile-header .mobile-title {
                font-size: 14px;
                line-height: 1.2;
            }

            .mobile-header .mobile-subtitle {
                font-size: 12px;
                line-height: 1.2;
            }

            .status-icon {
                width: 16px;
                height: 16px;
            }

            .mobile-grid {
                flex: 1;
                padding: 60px 24px 0;
                display: grid;
                grid-template-columns: repeat(3, 1fr);
                grid-auto-rows: min-content;
                align-content: start;
                justify-items: center;
                gap: 24px 12px;
                overflow-y: auto;
            }

            .mobile-app {
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 6px;
                background: none;
                border: none;
                padding: 0;
                cursor: pointer;
                -webkit-tap-highlight-color: transparent;
            }

            .mobile-app-icon {
                width: 72px;
                height: 72px;
                border-radius: 18px;
                display: flex;
                align-items: center;
                justify-content: center;
                box-shadow: 0 6px 16px rgba(0, 0, 0, 0.25);
                color: white;
                transition: transform 0.1s ease;
            }

            .mobile-app:active .mobile-app-icon {
                transform: scale(0.92);
                opacity: 0.8;
            }

            .mobile-app-icon svg {
                width: 36px;
                height: 36px;
                filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
            }

            .mobile-app-label {
                font-size: 12px;
                color: var(--ink);
                text-align: center;
                width: 100%;
                max-width: 90px;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
                font-weight: 500;
                text-shadow: 0 1px 3px rgba(0, 0, 0, 0.4);
            }

            html[data-theme="light"] .mobile-app-label {
                text-shadow: 0 1px 3px rgba(255, 255, 255, 0.8);
                font-weight: 600;
            }

            .mobile-dock {
                height: 96px;
                margin: 0 16px 16px;
                background: rgba(255, 255, 255, 0.08);
                backdrop-filter: blur(16px);
                -webkit-backdrop-filter: blur(16px);
                border-radius: 32px;
                border: 1px solid rgba(255, 255, 255, 0.15);
                display: flex;
                align-items: center;
                justify-content: space-around;
                padding: 0 16px;
                z-index: 10;
                flex-shrink: 0;
                box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
            }

            html[data-theme="light"] .mobile-dock {
                background: rgba(255, 255, 255, 0.28);
                border-color: rgba(255, 255, 255, 0.4);
                box-shadow: 0 6px 14px rgba(15, 23, 42, 0.08);
            }

            .mobile-app.dock-app .mobile-app-label {
                display: none;
            }

            .modal-window {
                width: 100%;
                height: 100%;
                max-width: none;
                max-height: none;
                border-radius: 0;
                border: none;
            }

            .window-chrome {
                padding-top: max(env(safe-area-inset-top), 12px);
            }
        }

        /* --- Dynamic Weather Styles --- */
        :root {
            --wx-sunny-bg: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            /* Clear Blue Sky */
            --wx-night-bg: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            /* Deep Night */
            --wx-cloudy-bg: linear-gradient(135deg, #64748b 0%, #475569 100%);
            /* Overcast Grey */
            --wx-rain-bg: linear-gradient(135deg, #334155 0%, #1e293b 100%);
            /* Dark Rain */
            --wx-snow-bg: linear-gradient(135deg, #94a3b8 0%, #64748b 100%);
            /* Cold Grey */
            --wx-thunder-bg: linear-gradient(135deg, #1e1b4b 0%, #312e81 100%);
            /* Stormy Purple */
        }

        /* Modal Overrides based on data-weather attribute */
        .modal-window[data-weather="sunny"] .window-chrome,
        .modal-window[data-weather="sunny"] .modal-content {
            background: var(--wx-sunny-bg);
            color: white;
        }

        .modal-window[data-weather="partly"] .window-chrome,
        .modal-window[data-weather="partly"] .modal-content {
            background: var(--wx-sunny-bg);
            color: white;
        }

        .modal-window[data-weather="night"] .window-chrome,
        .modal-window[data-weather="night"] .modal-content {
            background: var(--wx-night-bg);
            color: white;
        }

        .modal-window[data-weather="cloudy"] .window-chrome,
        .modal-window[data-weather="cloudy"] .modal-content {
            background: var(--wx-cloudy-bg);
            color: white;
        }

        .modal-window[data-weather="rain"] .window-chrome,
        .modal-window[data-weather="rain"] .modal-content {
            background: var(--wx-rain-bg);
            color: white;
        }

        .modal-window[data-weather="snow"] .window-chrome,
        .modal-window[data-weather="snow"] .modal-content {
            background: var(--wx-snow-bg);
            color: white;
        }

        .modal-window[data-weather="thunder"] .window-chrome,
        .modal-window[data-weather="thunder"] .modal-content {
            background: var(--wx-thunder-bg);
            color: white;
        }

        /* fix chrome borders when themed */
        .modal-window[data-weather] .window-chrome {
            border-bottom-color: rgba(255, 255, 255, 0.1);
        }

        .modal-window[data-weather] .modal-footer {
            background: rgba(0, 0, 0, 0.2);
            border-top-color: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.7);
        }

        .modal-window[data-weather] .window-title {
            color: white;
        }

        .modal-window[data-weather] .window-controls button {
            background: rgba(255, 255, 255, 0.2);
        }

        /* Weather Card Layout */
        .weather-card {
            display: flex;
            flex-direction: column;
            gap: 24px;
            text-align: center;
            padding-top: 10px;
        }

        .weather-main {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
        }

        .weather-main-temp {
            font-size: 48px;
            font-weight: 700;
            letter-spacing: -0.03em;
            line-height: 1;
        }

        .weather-main-condition {
            font-size: 16px;
            font-weight: 500;
            opacity: 0.9;
            text-transform: capitalize;
        }

        .weather-main-icon {
            width: 80px;
            height: 80px;
            margin-bottom: 8px;
        }

        .weather-main-icon svg {
            width: 100%;
            height: 100%;
            display: block;
        }

        .weather-forecast {
            display: flex;
            justify-content: space-between;
            background: rgba(0, 0, 0, 0.15);
            border-radius: 12px;
            padding: 12px 16px;
        }

        .forecast-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            font-size: 12px;
        }

        .forecast-time {
            opacity: 0.7;
        }

        .forecast-temp {
            font-weight: 600;
            font-size: 14px;
        }

        .forecast-icon {
            width: 24px;
            height: 24px;
        }

        /* Animations */
        @keyframes spin {
            100% {
                transform: rotate(360deg);
            }
        }

        @keyframes pulse-flash {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.6;
            }
        }

        @keyframes drift {
            0% {
                transform: translateX(0);
            }

            50% {
                transform: translateX(4px);
            }

            100% {
                transform: translateX(0);
            }
        }

        @keyframes rain-drop {
            0% {
                transform: translateY(0);
                opacity: 0;
            }

            50% {
                opacity: 1;
            }

            100% {
                transform: translateY(10px);
                opacity: 0;
            }
        }

        .weather-anim.weather-sunny .sun-core {
            animation: pulse-flash 3s ease-in-out infinite;
        }

        .weather-anim.weather-sunny path {
            animation: spin 12s linear infinite;
            transform-origin: center;
        }

        .weather-anim.weather-partly .sun-core {
            animation: pulse-flash 3s ease-in-out infinite;
        }

        .weather-anim.weather-rain .drop {
            animation: rain-drop 1s linear infinite;
        }

        .weather-anim.weather-rain .drop:nth-child(2) {
            animation-delay: 0.2s;
        }

        .weather-anim.weather-rain .drop:nth-child(3) {
            animation-delay: 0.4s;
        }

        .weather-anim.weather-snow .flake {
            animation: drift 3s ease-in-out infinite;
        }

        .weather-anim.weather-snow .flake:nth-child(2) {
            animation-delay: 1s;
        }

        .weather-anim.weather-thunder .bolt {
            animation: pulse-flash 0.5s ease-in-out infinite;
        }
    </style>
</head>

<body>
    <div class="desktop-shell">
        <header class="topbar">
            <div class="topbar-inner">
                <div class="topbar-left">
                    <span class="status-dot" aria-hidden="true"></span>
                    <button class="brand-btn" id="brandMenuBtn" type="button" aria-haspopup="true"
                        aria-expanded="false">
                        <span class="brand-text">Rob OS</span>
                        <span class="chev" aria-hidden="true"></span>
                    </button>
                    <a class="icon-btn" id="githubBtn" href="https://github.com/robfiasco" target="_blank"
                        rel="noopener noreferrer" aria-label="GitHub" title="GitHub">
                        <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                            <path
                                d="M12 2a10 10 0 00-3.162 19.49c.5.092.684-.217.684-.48 0-.237-.008-.866-.012-1.7-2.782.604-3.369-1.342-3.369-1.342-.454-1.155-1.11-1.463-1.11-1.463-.907-.62.069-.608.069-.608 1.003.07 1.532 1.03 1.532 1.03.892 1.53 2.341 1.089 2.91.833.091-.647.35-1.09.636-1.34-2.22-.252-4.555-1.11-4.555-4.943 0-1.092.39-1.986 1.03-2.686-.103-.253-.447-1.27.098-2.648 0 0 .84-.27 2.75 1.026a9.56 9.56 0 015.01 0c1.909-1.296 2.748-1.026 2.748-1.026.546 1.378.202 2.395.1 2.648.64.7 1.028 1.594 1.028 2.686 0 3.842-2.338 4.688-4.566 4.936.36.31.68.92.68 1.855 0 1.338-.012 2.42-.012 2.75 0 .266.18.576.688.478A10 10 0 0012 2z" />
                        </svg>
                    </a>
                    <a class="icon-btn" id="linkedinBtn" href="https://www.linkedin.com/in/rob-fiasco-5601a210b/"
                        target="_blank" rel="noopener noreferrer" aria-label="LinkedIn" title="LinkedIn">
                        <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                            <path
                                d="M4.98 3.5a2.5 2.5 0 11-.02 5 2.5 2.5 0 01.02-5zM3 9h4v12H3zM9 9h3.8v1.64h.05c.53-1 1.82-2.06 3.75-2.06 4.01 0 4.75 2.64 4.75 6.08V21h-4v-5.42c0-1.29-.02-2.95-1.8-2.95-1.8 0-2.07 1.4-2.07 2.85V21H9z" />
                        </svg>
                    </a>
                </div>

                <div class="topbar-right">
                    <button class="icon-btn" id="themeBtn" type="button" aria-label="Toggle theme" title="Toggle theme">
                        <span id="themeToggleIcon"></span>
                    </button>
                    <div class="weather-chip" id="weatherChip" aria-live="polite">
                        <span class="wx-icon" id="wxIcon" title="Weather unavailable" aria-label="Weather icon"></span>
                        <span id="wxText">Jamestown 18  Mostly clear</span>
                    </div>
                    <span id="clock">Thu 18:23</span>
                </div>
                <div class="topbar-popover" id="topbarPopover" aria-hidden="true">
                    <div class="topbar-popover-title">CDIR</div>
                    <div class="topbar-popover-text">Now playing integration coming</div>
                    <button class="open-cdir" type="button" id="openCdir">Open CDIR</button>
                </div>
            </div>
        </header>

        <div class="desktop">
            <div class="icon-grid left" id="iconGridLeft"></div>
            <div class="icon-grid right" id="iconGridRight"></div>
        </div>

        <div class="helper-tip" id="helperTip">
            <span> Tip: Double-click an icon to open. Start with <strong>Case Studies</strong>.</span>
            <button class="helper-close" id="helperClose" aria-label="Dismiss tip"></button>
        </div>

        <div class="status-strip" id="statusStrip">
            <span class="status-glyph" aria-hidden="true">i</span>
            <span id="statusText" class="status-text">Ready.</span>
        </div>

        <div class="boot-toast" id="bootToast">
            <div>RobOS v1.0 initialized</div>
            <div>Portfolio environment ready</div>
        </div>

        <div class="toggle-hint" id="themeHint">Dark mode not your thing? </div>

        <div class="context-menu" id="contextMenu" role="menu" aria-hidden="true">
            <button type="button" data-action="about">About Rob</button>
            <button type="button" data-action="case-studies">Case Studies</button>
            <button type="button" data-action="contact">Contact</button>
            <button type="button" data-action="toggle-theme">Toggle Dark/Light Mode</button>

            <div class="context-divider"></div>
            <div class="context-section">Change Background</div>
            <div id="bgMenuItems"></div>
        </div>

        <div class="selection-box" id="selectionBox"></div>

        <div class="preview-card" id="previewCard" aria-hidden="true">
            <div class="preview-label">Preview</div>
            <div class="preview-title" id="previewTitle">Preview</div>
            <div class="preview-media" id="previewMedia">
                <div class="preview-skeleton"></div>
                <img class="previewThumb" id="previewImage" alt="" loading="lazy">
                <div class="preview-fallback" id="previewFallback">Preview unavailable (Open to view)</div>
            </div>
            <div class="preview-actions">
                <button type="button" class="preview-action" id="previewOpen">Open</button>
                <button type="button" class="preview-action" id="previewOpenNew">Open in new tab</button>
            </div>
        </div>
    </div>

    <div class="mobile-shell">
        <div class="mobile-status-bar">
            <span class="mobile-time" id="mobileTime">--:--</span>
            <div class="mobile-status-right">
                <svg class="status-icon" viewBox="0 0 24 24">
                    <path fill="currentColor" d="M12 21L24 6H0L12 21Z" />
                </svg>
                <svg class="status-icon" viewBox="0 0 24 24">
                    <path fill="currentColor"
                        d="M16 4H8V2H16V4ZM18 6V20C18 21.1 17.1 22 16 22H8C6.9 22 6 21.1 6 20V6H18Z" />
                </svg>
            </div>
        </div>

        <div class="mobile-grid" id="mobileGrid"></div>
        <div class="mobile-dock" id="mobileDock"></div>
    </div>

    <div class="modal-overlay" id="modalOverlay" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
        <div class="modal-window" id="modalWindow">
            <div class="window-chrome">
                <div class="window-title-group">
                    <span class="window-icon" id="modalIcon" aria-hidden="true"></span>
                    <div class="window-title" id="modalTitle"></div>
                </div>
                <button class="close-button" id="closeButton" aria-label="Close">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <div class="modal-content" id="modalContent"></div>
            <div class="modal-footer">Esc to close  Click outside to dismiss</div>
        </div>
    </div>

    <script>

        const icons = [
            {
                id: 'about',
                label: 'About.txt',
                type: 'modal',
                content: 'about',
                icon: 'profile',
                accent: '#22d3ee',
                previewImg: './assets/previews/about.png',
                previewUrl: 'about', // Added to trigger preview logic
                description: 'About.txt  background, focus areas, and systems shipped. Open to read.'
            },
            {
                id: 'cdir',
                label: 'CDIR',
                type: 'external',
                url: 'https://radio.chadakoindigital.com',
                previewUrl: 'https://radio.chadakoindigital.com',
                previewImg: './assets/previews/cdir.png',
                icon: 'radio',
                accent: '#2dd4bf',
                description: 'CDIR  living radio system + automation pipeline. Opens in a new tab.'
            },
            {
                id: 'lotdqq',
                label: 'LOTDQQ',
                type: 'external',
                url: 'https://lotdqq.com',
                previewUrl: 'https://lotdqq.com',
                previewImg: './assets/previews/lotdqq.png',
                icon: 'quiz',
                accent: '#8b5cf6',
                description: 'LOTDQQ  shipped trivia app. Opens in a new tab.'
            },
            {
                id: 'good-budget',
                label: 'Good Budget',
                type: 'modal',
                content: 'good-budget',
                icon: 'budget',
                accent: '#22c55e',
                previewImg: './assets/previews/good-budget.png',
                previewUrl: 'good-budget',
                description: 'Good Budget  practical budget prototype. Open for details.'
            },
            {
                id: 'sep-1',
                type: 'separator'
            },
            {
                id: 'microlifts',
                label: 'MicroLifts',
                type: 'modal',
                content: 'microlifts',
                icon: 'dumbbell',
                accent: '#3b82f6',
                previewImg: './assets/previews/microlifts.png',
                previewUrl: 'microlifts',
                description: 'MicroLifts  iOS strength tracker (SwiftUI). Open for screenshots + details.'
            },
            {
                id: 'case-studies',
                label: 'Case Studies',
                type: 'modal',
                content: 'case-studies',
                icon: 'docs',
                accent: '#f59e0b',
                previewImg: './assets/previews/case-studies.png',
                previewUrl: 'case-studies',
                description: 'Case Studies  deep dives into selected builds. Open for details.'
            },
            {
                id: 'build-archive',
                label: 'Build Archive',
                type: 'modal',
                content: 'build-archive',
                icon: 'flask',
                accent: '#7c3aed',
                previewImg: './assets/previews/build-archive.png',
                previewUrl: 'build-archive',
                description: 'Build Archive  experiments and shipped builds. Open for the list.'
            },
            {
                id: 'sep-2',
                type: 'separator'
            },
            {
                id: 'contact',
                label: 'Contact',
                type: 'modal',
                content: 'contact',
                icon: 'chat',
                accent: '#6366f1',
                previewImg: './assets/previews/contact.png',
                previewUrl: 'contact', // Added to trigger preview logic
                description: 'Contact  email. Open to view.'
            },
            {
                id: 'sep-system-log',
                type: 'separator'
            },
            {
                id: 'system-log',
                label: 'System.log',
                type: 'modal',
                content: 'system-log',
                icon: 'terminal',
                accent: '#10b981',
                previewImg: './assets/previews/system-log.png',
                previewUrl: 'system-log', // Added to trigger preview logic
                description: 'System.log  recent activity and updates. Open to view.'
            },
            {
                id: 'weather',
                label: 'Weather',
                type: 'modal',
                content: 'weather',
                icon: 'weather',
                accent: '#3b82f6',
                description: 'Current local weather.'
            }
        ];

        let selectedIconIndex = -1;
        let currentCaseStudy = null;
        let previousFocusElement = null;
        let pageLoadTime = Date.now();
        let systemInfo = null;
        const defaultStatusText = 'Hover an icon to preview what it is  Double-click to open';
        // Thumbnail previews use thum.io and are cached locally.
        const THUMB_ENDPOINT = 'https://image.thum.io/get/width/800/';
        const thumbCache = new Map();
        const thumbCacheKey = 'thumb_cache_v1';
        const thumbCacheTTL = 6 * 60 * 60 * 1000;
        let lastWeatherData = null;
        const bgPresets = {
            dark: {
                mint: {
                    label: 'Background: Mint',
                    vars: {
                        '--bg-base': '#2e3a4f',
                        '--bg-top': '#3a4a63',
                        '--bg-bottom': '#253247',
                        '--bg-bloom-blue': 'rgba(56, 189, 248, 0.22)',
                        '--bg-bloom-mint': 'rgba(20, 184, 166, 0.18)',
                        '--grid-color': 'rgba(148, 163, 184, 0.02)',
                        '--grain-opacity': '0.02',
                        '--grain-contrast': '110%'
                    }
                },
                violet: {
                    label: 'Background: Violet',
                    vars: {
                        '--bg-base': '#2a2437',
                        '--bg-top': '#3a2d4d',
                        '--bg-bottom': '#211a2d',
                        '--bg-bloom-blue': 'rgba(167, 139, 250, 0.24)',
                        '--bg-bloom-mint': 'rgba(45, 212, 191, 0.14)',
                        '--grid-color': 'rgba(148, 163, 184, 0.022)',
                        '--grain-opacity': '0.028',
                        '--grain-contrast': '112%'
                    }
                },
                blue: {
                    label: 'Background: Deep Blue',
                    vars: {
                        '--bg-base': '#1f2f45',
                        '--bg-top': '#2a3f5b',
                        '--bg-bottom': '#182538',
                        '--bg-bloom-blue': 'rgba(59, 130, 246, 0.28)',
                        '--bg-bloom-mint': 'rgba(56, 189, 248, 0.1)',
                        '--grid-color': 'rgba(148, 163, 184, 0.018)',
                        '--grain-opacity': '0.022',
                        '--grain-contrast': '108%'
                    }
                }
            },
            light: {
                mint: {
                    label: 'Background: Mint',
                    vars: {
                        '--bg-base': '#f6fbf9',
                        '--bg-top': '#eef8f5',
                        '--bg-bottom': '#e9f2ef',
                        '--bg-bloom-blue': 'rgba(16, 185, 129, 0.18)',
                        '--bg-bloom-mint': 'rgba(45, 212, 191, 0.14)',
                        '--grid-color': 'rgba(15, 23, 42, 0.03)',
                        '--grain-opacity': '0.032',
                        '--grain-contrast': '104%'
                    }
                },
                sky: {
                    label: 'Background: Sky',
                    vars: {
                        '--bg-base': '#f4f8ff',
                        '--bg-top': '#ecf2ff',
                        '--bg-bottom': '#e6edf7',
                        '--bg-bloom-blue': 'rgba(59, 130, 246, 0.2)',
                        '--bg-bloom-mint': 'rgba(14, 165, 233, 0.14)',
                        '--grid-color': 'rgba(15, 23, 42, 0.028)',
                        '--grain-opacity': '0.03',
                        '--grain-contrast': '104%'
                    }
                },
                sand: {
                    label: 'Background: Sand',
                    vars: {
                        '--bg-base': '#faf6ee',
                        '--bg-top': '#fcf4e6',
                        '--bg-bottom': '#f2eadf',
                        '--bg-bloom-blue': 'rgba(251, 146, 60, 0.16)',
                        '--bg-bloom-mint': 'rgba(34, 197, 94, 0.08)',
                        '--grid-color': 'rgba(15, 23, 42, 0.026)',
                        '--grain-opacity': '0.028',
                        '--grain-contrast': '103%'
                    }
                }
            }
        };

        const aboutFullHTML = `
            <div class="about-txt">
                <pre class="about-header">ROB OS
status: building
mode: remote-only
focus: AI-native product building</pre>
                <div class="content-section">
                    <p><span class="about-highlight">End-to-end:</span> blank page  working product  iterate.</p>
                    <p>AI-native product builder focused on fintech, payments, automation, and internal tools. Strong operations + systems background. Remote-only.</p>
                </div>
                <hr class="about-divider">
                <div class="content-section">
                    <div class="about-label">Origin (short)</div>
                    <div class="about-log">1) Early career across retail + banking  operations, customer, financial systems.</div>
                    <div class="about-log">2) Small-team ERP: implementations, QA, UI, testing, client systems.</div>
                    <div class="about-log">3) Crypto/fintech: Binance.US from CX  leadership  program management  treasury analyst.</div>
                </div>
                <div class="content-section">
                    <div class="about-label">Current identity</div>
                    <p>AI-native builder using modern AI tools daily to design, prototype, and ship real products fast.</p>
                </div>
                <div class="content-section">
                    <div class="about-label">Focus areas</div>
                    <div class="about-log"> Fintech / neo-banking / payments infrastructure</div>
                    <div class="about-log"> Internal tools + automation</div>
                    <div class="about-log"> AI-assisted product development</div>
                    <div class="about-log"> Systems thinking + shipping end-to-end</div>
                    <div class="about-log"> Remote-first teams</div>
                </div>
                <div class="content-section">
                    <div class="about-label">What I build</div>
                    <div class="about-log"> AI-native tools with real integrations</div>
                    <div class="about-log"> Automation that removes manual work</div>
                    <div class="about-log"> Clean, fast interfaces</div>
                    <div class="about-log"> Reliable systems with instrumentation</div>
                </div>
                <div class="content-section">
                    <div class="about-label">Systems shipped</div>
                    <div class="about-log"> CDIR: live radio system (complete, maintained)</div>
                    <div class="about-log"> LOTDQQ: shipped trivia platform (iOS expansion planned)</div>
                    <div class="about-log"> Good Budget: working fintech-style prototype</div>
                    <div class="about-log"> MicroLifts: iOS strength tracker</div>
                </div>
            </div>
        `;


        function getDeviceType() {
            const width = window.innerWidth;
            if (width < 768) return 'mobile';
            if (width < 1024) return 'tablet';
            return 'desktop';
        }

        function getSrcParam() {
            const params = new URLSearchParams(window.location.search);
            return params.get('src') || sessionStorage.getItem('src') || null;
        }

        function trackEvent(eventName, target = null, extraData = {}) {
            const event = {
                eventName,
                target,
                timestamp: new Date().toISOString(),
                srcQuery: getSrcParam(),
                deviceType: getDeviceType(),
                ...extraData
            };

            console.log('[Analytics]', event);

            const events = JSON.parse(localStorage.getItem('analytics_events') || '[]');
            events.push(event);

            if (events.length > 50) events.shift();
            localStorage.setItem('analytics_events', JSON.stringify(events));
        }

        function initAnalytics() {
            const sessionData = {
                timestamp: new Date().toISOString(),
                browser: navigator.userAgent.split(/[()]/)[1] || navigator.userAgent.substring(0, 50),
                screenSize: `${window.screen.width}x${window.screen.height}`,
                viewport: `${window.innerWidth}x${window.innerHeight}`
            };
            console.log('Visitor session started', sessionData);
        }


        // Enrich system info with coarse location data from ipapi.co when available.
        async function collectSystemInfo() {
            const info = {
                browser: getBrowserName(),
                os: getOSName(),
                screenResolution: `${window.screen.width}  ${window.screen.height}`,
                viewport: `${window.innerWidth}  ${window.innerHeight}`,
                timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                language: navigator.language,
                timeOnPage: '0s',
                firstVisit: new Date().toLocaleString()
            };

            try {
                const response = await fetch('https://ipapi.co/json/', { timeout: 3000 });
                if (response.ok) {
                    const data = await response.json();
                    info.city = data.city || 'Unknown';
                    info.region = data.region || 'Unknown';
                    info.country = data.country_name || 'Unknown';
                }
            } catch (e) {

            }

            systemInfo = info;
            return info;
        }

        function getBrowserName() {
            const ua = navigator.userAgent;
            if (ua.includes('Chrome') && !ua.includes('Edg')) return 'Chrome';
            if (ua.includes('Safari') && !ua.includes('Chrome')) return 'Safari';
            if (ua.includes('Firefox')) return 'Firefox';
            if (ua.includes('Edg')) return 'Edge';
            return 'Unknown';
        }

        function getOSName() {
            const ua = navigator.userAgent;
            if (ua.includes('Win')) return 'Windows';
            if (ua.includes('Mac')) return 'macOS';
            if (ua.includes('Linux')) return 'Linux';
            if (ua.includes('Android')) return 'Android';
            if (ua.includes('iPhone') || ua.includes('iPad')) return 'iOS';
            return 'Unknown';
        }

        function updateTimeOnPage() {
            const elapsed = Math.floor((Date.now() - pageLoadTime) / 1000);
            const minutes = Math.floor(elapsed / 60);
            const seconds = elapsed % 60;
            return minutes > 0 ? `${minutes}m ${seconds}s` : `${seconds}s`;
        }


        function applyTimeOfDayMode() {
            const hour = new Date().getHours();
            const body = document.body;

            body.classList.remove('time-morning', 'time-afternoon', 'time-evening', 'time-night');

            if (hour >= 6 && hour < 12) {
                body.classList.add('time-morning');
            } else if (hour >= 12 && hour < 18) {
                body.classList.add('time-afternoon');
            } else if (hour >= 18 && hour < 22) {
                body.classList.add('time-evening');
            } else {
                body.classList.add('time-night');
            }
        }


        function updateClock() {
            const now = new Date();
            const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            const day = days[now.getDay()];
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            document.getElementById('clock').textContent = `${day} ${hours}:${minutes}`;
        }

        function initWeatherUI() {
            const chipEl = document.getElementById('weatherChip');
            if (!chipEl) return;
            chipEl.addEventListener('click', () => {
                openModal('weather', 'Weather');
            });
        }

        function initBrandMenu() {
            const button = document.getElementById('brandMenuBtn');
            const popover = document.getElementById('topbarPopover');
            const openBtn = document.getElementById('openCdir');
            if (!button || !popover) return;

            const close = () => {
                popover.classList.remove('active');
                popover.setAttribute('aria-hidden', 'true');
                button.setAttribute('aria-expanded', 'false');
            };

            const open = () => {
                popover.classList.add('active');
                popover.setAttribute('aria-hidden', 'false');
                button.setAttribute('aria-expanded', 'true');
            };

            button.addEventListener('click', (e) => {
                e.stopPropagation();
                if (popover.classList.contains('active')) {
                    close();
                } else {
                    open();
                }
            });

            document.addEventListener('click', (e) => {
                if (!popover.contains(e.target) && e.target !== button) {
                    close();
                }
            });

            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    close();
                }
            });

            if (openBtn) {
                openBtn.addEventListener('click', () => {
                    window.open('https://radio.chadakoindigital.com', '_blank', 'noopener,noreferrer');
                });
            }
        }

        function getThumbUrl(url) {
            const encoded = encodeURIComponent(url);
            return `${THUMB_ENDPOINT}${encoded}`;
        }

        function getThumbCache() {
            const cached = localStorage.getItem(thumbCacheKey);
            if (!cached) return {};
            try {
                return JSON.parse(cached);
            } catch (e) {
                return {};
            }
        }

        function setThumbCache(url, entry) {
            thumbCache.set(url, entry);
            const existing = getThumbCache();
            existing[url] = entry;
            localStorage.setItem(thumbCacheKey, JSON.stringify(existing));
        }

        function getCachedThumb(url) {
            if (thumbCache.has(url)) return thumbCache.get(url);
            const stored = getThumbCache();
            const entry = stored[url];
            if (entry && Date.now() - entry.timestamp < thumbCacheTTL) {
                thumbCache.set(url, entry);
                return entry;
            }
            return null;
        }

        function loadThumb(url) {
            const src = getThumbUrl(url);
            return new Promise((resolve) => {
                const img = new Image();
                img.onload = () => resolve({ status: 'loaded', src, timestamp: Date.now() });
                img.onerror = () => resolve({ status: 'error', src: null, timestamp: Date.now() });
                img.src = src;
            });
        }

        function prefetchThumbnails() {
            ['https://radio.chadakoindigital.com', 'https://lotdqq.com'].forEach(async (url) => {
                const cached = getCachedThumb(url);
                if (cached) return;
                const result = await loadThumb(url);
                setThumbCache(url, result);
            });
        }

        function initPreviewHover() {
            const card = document.getElementById('previewCard');
            const title = document.getElementById('previewTitle');
            const media = document.getElementById('previewMedia');
            const openBtn = document.getElementById('previewOpen');
            const openNewBtn = document.getElementById('previewOpenNew');
            const image = document.getElementById('previewImage');
            if (!card || !title || !media || !image || !openBtn || !openNewBtn) return;
            if (window.matchMedia('(max-width: 768px)').matches) return;

            let activeIcon = null;
            let hideTimer = null;

            const hide = () => {
                card.classList.remove('active');
                card.setAttribute('aria-hidden', 'true');
                activeIcon = null;
            };

            const scheduleHide = () => {
                if (hideTimer) clearTimeout(hideTimer);
                hideTimer = setTimeout(hide, 100);
            };

            const cancelHide = () => {
                if (hideTimer) clearTimeout(hideTimer);
            };

            const positionCard = (anchor) => {
                const rect = anchor.getBoundingClientRect();
                const cardRect = card.getBoundingClientRect();
                const padding = 12;
                let left = rect.right + 12;
                let top = rect.top + (rect.height - cardRect.height) / 2;
                if (left + cardRect.width > window.innerWidth - padding) {
                    left = rect.left - cardRect.width - 12;
                }
                left = Math.max(padding, Math.min(left, window.innerWidth - cardRect.width - padding));
                top = Math.max(padding, Math.min(top, window.innerHeight - cardRect.height - padding));
                card.style.left = `${left}px`;
                card.style.top = `${top}px`;
            };

            const show = (icon) => {
                const previewTitle = icon.getAttribute('data-preview-title');
                const previewImg = icon.getAttribute('data-preview-img');
                const previewUrl = icon.getAttribute('data-preview-url');
                const type = icon.getAttribute('data-type');

                if (!previewTitle) return;
                activeIcon = icon;
                title.textContent = previewTitle;
                media.classList.remove('loaded', 'error');

                // Toggle "Open in new tab" button
                if (type === 'external') {
                    openNewBtn.style.cssText = 'display: flex !important;';
                } else {
                    openNewBtn.style.cssText = 'display: none !important;';
                }

                // Prioritize local preview image if available
                if (previewImg) {
                    image.src = previewImg;
                    media.classList.add('loaded');
                } else {
                    const cached = getCachedThumb(previewUrl);
                    if (cached && cached.status === 'loaded' && cached.src) {
                        image.src = cached.src;
                        media.classList.add('loaded');
                    } else if (cached && cached.status === 'error') {
                        media.classList.add('error');
                    } else if (previewUrl) {
                        image.removeAttribute('src');
                        loadThumb(previewUrl).then((result) => {
                            setThumbCache(previewUrl, result);
                            if (activeIcon !== icon) return;
                            if (result.status === 'loaded' && result.src) {
                                image.src = result.src;
                                media.classList.add('loaded');
                            } else {
                                media.classList.add('error');
                            }
                        });
                    } else {
                        media.classList.add('error');
                    }
                }
                openBtn.onclick = () => {
                    const index = icon.getAttribute('data-index');
                    if (index !== null) openIcon(Number(index));
                };
                openNewBtn.onclick = () => {
                    window.open(previewUrl, '_blank', 'noopener,noreferrer');
                };
                card.classList.add('active');
                card.setAttribute('aria-hidden', 'false');
                requestAnimationFrame(() => positionCard(icon));
            };

            document.querySelectorAll('[data-preview-title]').forEach((icon) => {
                icon.addEventListener('mouseenter', () => {
                    cancelHide();
                    show(icon);
                });
                icon.addEventListener('mouseleave', scheduleHide);
            });

            card.addEventListener('mouseenter', cancelHide);
            card.addEventListener('mouseleave', scheduleHide);

            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') hide();
            });

            window.addEventListener('resize', () => {
                if (activeIcon) positionCard(activeIcon);
            });
        }

        function isMobileLayout() {
            return window.matchMedia('(max-width: 768px)').matches;
        }

        function setStatus(text, { announce = false } = {}) {
            const statusEl = document.getElementById('statusText');
            const stripEl = document.getElementById('statusStrip');
            if (!statusEl || !stripEl) return;
            statusEl.classList.add('updating');
            stripEl.classList.add('pulse');
            setTimeout(() => {
                statusEl.textContent = text || defaultStatusText;
                statusEl.classList.remove('updating');
                stripEl.classList.remove('pulse');
                if (announce) {
                    statusEl.setAttribute('aria-live', 'polite');
                } else {
                    statusEl.removeAttribute('aria-live');
                }
            }, 160);
        }

        function resetStatus() {
            setStatus(defaultStatusText, { announce: false });
        }

        function getIconSVG(iconType) {
            const svgs = {
                app: '<rect x="3" y="3" width="18" height="18" rx="4"/><rect x="6.5" y="6.5" width="11" height="7" rx="2" fill="currentColor" opacity="0.22"/><line x1="7" y1="16" x2="17" y2="16"/><line x1="7" y1="18" x2="13" y2="18"/>',
                radio: '<circle cx="9" cy="11" r="2"/><path stroke-linecap="round" stroke-linejoin="round" d="M3 15h18M6 15v4M18 15v4"/><path stroke-linecap="round" stroke-linejoin="round" d="M13 8c1.7 1.7 1.7 4.3 0 6M16 6c2.9 2.9 2.9 7.1 0 10"/>',
                quiz: '<rect x="4" y="4" width="16" height="14" rx="3"/><path stroke-linecap="round" stroke-linejoin="round" d="M9 9a2 2 0 1 1 2 2v1"/><circle cx="11" cy="14.5" r="0.8" fill="currentColor" stroke="none"/>',
                budget: '<rect x="4" y="4" width="16" height="16" rx="3"/><path stroke-linecap="round" stroke-linejoin="round" d="M8 8h8M8 12h8M8 16h5"/><path stroke-linecap="round" stroke-linejoin="round" d="M6 6h2"/><path stroke-linecap="round" stroke-linejoin="round" d="M6 10h2"/><path stroke-linecap="round" stroke-linejoin="round" d="M6 14h2"/>',
                dumbbell: '<path stroke-linecap="round" stroke-linejoin="round" d="M7 10v4M17 10v4"/><path stroke-linecap="round" stroke-linejoin="round" d="M5 9v6M19 9v6"/><path stroke-linecap="round" stroke-linejoin="round" d="M7 12h10"/>',
                docs: '<rect x="5" y="5" width="12" height="14" rx="2"/><rect x="7.5" y="3" width="11" height="14" rx="2" opacity="0.2" fill="currentColor"/><path stroke-linecap="round" d="M8 9h6M8 12h6M8 15h4"/>',
                profile: '<circle cx="12" cy="9" r="3.2"/><path stroke-linecap="round" stroke-linejoin="round" d="M5 20c1.6-3.2 4-4.8 7-4.8s5.4 1.6 7 4.8"/>',
                chat: '<path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16v9a3 3 0 0 1-3 3H9l-4 3v-3H7a3 3 0 0 1-3-3V6z"/><path stroke-linecap="round" d="M8 10h8"/>',
                doc: '<path stroke-linecap="round" stroke-linejoin="round" d="M7 21h10a2 2 0 0 0 2-2V9.5a1 1 0 0 0-.293-.707l-5.5-5.5A1 1 0 0 0 12.5 3H7a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2z"/><path d="M14 3v6h6" stroke-linecap="round" stroke-linejoin="round"/><rect x="7" y="14.5" width="10" height="4" rx="1.2" fill="currentColor" opacity="0.18"/>',
                flask: '<path stroke-linecap="round" stroke-linejoin="round" d="M10 3v4l-5 8a4 4 0 0 0 3.4 6h7.2a4 4 0 0 0 3.4-6l-5-8V3"/><path stroke-linecap="round" stroke-linejoin="round" d="M9 7h6"/><path stroke-linecap="round" stroke-linejoin="round" d="M9.5 14h5"/>',
                terminal: '<rect x="3" y="5" width="18" height="14" rx="2"/><rect x="5.5" y="7.5" width="13" height="3.5" rx="1.2" fill="currentColor" opacity="0.18"/><path stroke-linecap="round" stroke-linejoin="round" d="M7 12l3 2-3 2M12 16h5"/>',
                user: '<circle cx="12" cy="8" r="3.4"/><circle cx="12" cy="8" r="3.4" fill="currentColor" opacity="0.18"/><path stroke-linecap="round" stroke-linejoin="round" d="M5 20c1.6-3.2 4-4.8 7-4.8s5.4 1.6 7 4.8"/>',
                pdf: '<path stroke-linecap="round" stroke-linejoin="round" d="M7 21h10a2 2 0 0 0 2-2V9.5a1 1 0 0 0-.293-.707l-5.5-5.5A1 1 0 0 0 12.5 3H7a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2z"/><path d="M14 3v6h6" stroke-linecap="round" stroke-linejoin="round"/><rect x="7" y="14.5" width="10" height="4" rx="1.2" fill="currentColor" opacity="0.18"/>',
                folder: '<path stroke-linecap="round" stroke-linejoin="round" d="M3 7v10a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-6l-2-2H5a2 2 0 0 0-2 2z"/><rect x="5" y="10" width="10" height="5" rx="1" fill="currentColor" opacity="0.2"/>',
                mail: '<path stroke-linecap="round" stroke-linejoin="round" d="M3 8l7.89 5.26a2 2 0 0 0 2.22 0L21 8"/><rect x="3" y="7" width="18" height="12" rx="2"/>',
                weather: '<circle cx="12" cy="12" r="4" fill="currentColor"/><path d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M6.34 17.66l-1.41 1.41M19.07 4.93l-1.41 1.41" stroke-linecap="round" stroke-width="2"/>'
            };
            return svgs[iconType] || svgs.app;
        }

        function getWindowIcon(type) {
            const icons = {
                about: getIconSVG('user'),
                contact: getIconSVG('mail'),
                'case-studies': getIconSVG('folder'),
                'system-log': getIconSVG('terminal'),
                microlifts: getIconSVG('app'),
                'good-budget': getIconSVG('app'),
                diagnostics: getIconSVG('terminal'),
                weather: '<circle cx="12" cy="12" r="4"/><path d="M6 14h9a3 3 0 0 0 0-6 5 5 0 0 0-9.2 1.8" stroke-linecap="round"></path>'
            };
            const svg = icons[type] || getIconSVG('app');
            return `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor">${svg}</svg>`;
        }

        function weatherCodeToLabel(code) {
            if (code === 0) return 'Clear';
            if (code === 1 || code === 2) return 'Mostly clear';
            if (code === 3) return 'Cloudy';
            if (code === 45 || code === 48) return 'Fog';
            if (code >= 51 && code <= 57) return 'Drizzle';
            if (code >= 61 && code <= 67) return 'Rain';
            if (code >= 71 && code <= 77) return 'Snow';
            if (code >= 80 && code <= 82) return 'Showers';
            if (code >= 85 && code <= 86) return 'Snow showers';
            if (code >= 95) return 'Storm';
            return 'Weather';
        }

        function weatherCodeToType(code) {
            if (code === 0) return 'sunny';
            if (code === 1 || code === 2) return 'partly';
            if (code === 3) return 'cloudy';
            if (code === 45 || code === 48) return 'cloudy';
            if (code >= 51 && code <= 67) return 'rain';
            if (code >= 71 && code <= 77) return 'snow';
            if (code >= 80 && code <= 82) return 'rain';
            if (code >= 85 && code <= 86) return 'snow';
            if (code >= 95) return 'thunder';
            return 'cloudy';
        }

        function renderWeatherIcon(type) {
            if (type === 'neutral') {
                return `
                    <svg class="weather-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path d="M6 14h9a3 3 0 0 0 0-6 5 5 0 0 0-9.2 1.8" stroke-linecap="round"></path>
                    </svg>
                `;
            }
            const cls = `weather-icon weather-anim weather-${type}`;
            if (type === 'sunny') {
                return `
                    <svg class="${cls}" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <circle class="sun-core" cx="12" cy="12" r="4" fill="currentColor" opacity="0.25"></circle>
                        <circle class="sun-core" cx="12" cy="12" r="4"></circle>
                        <path d="M12 2v2M12 20v2M4.2 4.2l1.4 1.4M18.4 18.4l1.4 1.4M2 12h2M20 12h2M4.2 19.8l1.4-1.4M18.4 5.6l1.4-1.4" stroke-linecap="round"></path>
                    </svg>
                `;
            }
            if (type === 'partly') {
                return `
                    <svg class="${cls}" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <circle class="sun-core" cx="8" cy="9" r="3" fill="currentColor" opacity="0.25"></circle>
                        <circle class="sun-core" cx="8" cy="9" r="3"></circle>
                        <path d="M6 18h10a3 3 0 0 0 0-6 5 5 0 0 0-9.2 1.8" stroke-linecap="round"></path>
                    </svg>
                `;
            }
            if (type === 'rain') {
                return `
                    <svg class="${cls}" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path d="M6 14h9a3 3 0 0 0 0-6 5 5 0 0 0-9.2 1.8" stroke-linecap="round"></path>
                        <path class="drop" d="M8 17l-1 2" stroke-linecap="round"></path>
                        <path class="drop" d="M12 17l-1 2" stroke-linecap="round"></path>
                        <path class="drop" d="M16 17l-1 2" stroke-linecap="round"></path>
                    </svg>
                `;
            }
            if (type === 'snow') {
                return `
                    <svg class="${cls}" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path d="M6 14h9a3 3 0 0 0 0-6 5 5 0 0 0-9.2 1.8" stroke-linecap="round"></path>
                        <circle class="flake" cx="8" cy="18" r="1" fill="currentColor"></circle>
                        <circle class="flake" cx="12" cy="18" r="1" fill="currentColor"></circle>
                        <circle class="flake" cx="16" cy="18" r="1" fill="currentColor"></circle>
                    </svg>
                `;
            }
            if (type === 'thunder') {
                return `
                    <svg class="${cls}" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path d="M6 14h9a3 3 0 0 0 0-6 5 5 0 0 0-9.2 1.8" stroke-linecap="round"></path>
                        <path class="bolt" d="M12 15l-2 4h2l-1 3 3-5h-2l1-2z" fill="currentColor" stroke="none"></path>
                    </svg>
                `;
            }
            return renderWeatherIcon('neutral');
        }

        function formatUpdatedAgo(ts) {
            const mins = Math.max(0, Math.round((Date.now() - ts) / 60000));
            if (mins < 1) return 'just now';
            if (mins === 1) return '1m ago';
            return `${mins}m ago`;
        }

        // Fetch current weather from Open-Meteo and cache for 15 minutes.
        async function updateWeather() {
            const textEl = document.getElementById('wxText');
            const iconEl = document.getElementById('wxIcon');
            if (!textEl || !iconEl) return;
            const cacheKey = 'weather_cache';
            const cacheRaw = localStorage.getItem(cacheKey);
            const now = Date.now();
            if (cacheRaw) {
                try {
                    const cached = JSON.parse(cacheRaw);
                    if (cached && cached.timestamp && now - cached.timestamp < 15 * 60 * 1000) {
                        lastWeatherData = cached;
                        if (cached.temp !== null && cached.temp !== undefined) {
                            textEl.textContent = `Jamestown ${cached.temp}  ${cached.condition || ''}`;
                        } else {
                            textEl.textContent = 'Jamestown ';
                        }
                        iconEl.innerHTML = renderWeatherIcon(cached.type || 'cloudy');
                        iconEl.title = `Jamestown: ${cached.temp ?? ''}${cached.condition ? `  ${cached.condition}` : ''} (updated ${formatUpdatedAgo(cached.timestamp)})`;
                        return;
                    }
                } catch (e) {

                }
            }

            try {
                const lat = 42.0970;
                const lon = -79.2353;
                const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,weathercode&hourly=temperature_2m,weathercode&temperature_unit=fahrenheit`;
                const response = await fetch(url);
                if (!response.ok) throw new Error('Weather fetch failed');
                const data = await response.json();
                const current = data.current || {};
                const temp = typeof current.temperature_2m === 'number' ? Math.round(current.temperature_2m) : null;
                const condition = weatherCodeToLabel(current.weathercode);
                const type = weatherCodeToType(current.weathercode);

                // Determine theme based on type and time of day
                let theme = type;
                const hour = new Date().getHours();
                const isNight = hour >= 20 || hour < 6; // 8PM - 6AM

                if (isNight && (type === 'sunny' || type === 'partly' || type === 'cloudy')) {
                    theme = 'night';
                }

                const text = temp !== null ? `Jamestown ${temp}  ${condition}` : 'Jamestown ';

                const hourly = data.hourly || {};
                const forecast = [];
                if (Array.isArray(hourly.time) && Array.isArray(hourly.temperature_2m)) {
                    const nowIndex = hourly.time.findIndex((t) => new Date(t).getTime() >= now);
                    for (let i = 0; i < 3; i++) {
                        const idx = Math.max(0, nowIndex) + i + 1; // Start from next hour
                        // Ensure we don't go out of bounds
                        if (hourly.time[idx]) {
                            const hDate = new Date(hourly.time[idx]);
                            const hourStr = hDate.getHours().toString().padStart(2, '0');
                            const t = Math.round(hourly.temperature_2m[idx]);
                            const code = hourly.weathercode ? hourly.weathercode[idx] : null;
                            forecast.push({ hour: hourStr, temp: t, code: code });
                        }
                    }
                }

                lastWeatherData = {
                    text,
                    temp,
                    condition,
                    type,
                    theme,
                    timestamp: now,
                    forecast
                };

                textEl.textContent = text;
                iconEl.innerHTML = renderWeatherIcon(type);
                iconEl.title = `Jamestown: ${temp ?? ''}${condition ? `  ${condition}` : ''} (updated ${formatUpdatedAgo(now)})`;
                iconEl.title = `Jamestown: ${temp ?? ''}${condition ? `  ${condition}` : ''} (updated ${formatUpdatedAgo(now)})`;
                localStorage.setItem(cacheKey, JSON.stringify(lastWeatherData));

                const mobileWeatherIcon = document.querySelector('.mobile-app[data-id="weather"] .mobile-app-icon');
                if (mobileWeatherIcon && temp !== null) {
                    mobileWeatherIcon.innerHTML = `
                <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%;">
                    ${renderWeatherIcon(type).replace('width="24"', 'width="32"').replace('height="24"', 'height="32"')}
                    <span style="font-size: 14px; font-weight: 600; color: white; margin-top: -4px;">${temp}</span>
                </div>
            `;
                }
            } catch (e) {
                lastWeatherData = null;
                textEl.textContent = 'Jamestown ';
                iconEl.innerHTML = renderWeatherIcon('neutral');
                iconEl.title = 'Weather unavailable';
                console.error(e);
            }
        }


        function createIcons() {
            const gridLeft = document.getElementById('iconGridLeft');
            const gridRight = document.getElementById('iconGridRight');

            icons.forEach((icon, index) => {
                if (icon.type === 'separator') {
                    return;
                }
                const button = document.createElement('button');
                button.className = 'desktop-icon';
                if (['cdir', 'lotdqq', 'good-budget'].includes(icon.id)) {
                    button.classList.add('featured');
                }
                button.setAttribute('data-index', index);
                button.setAttribute('aria-label', icon.label);
                button.setAttribute('data-id', icon.id);
                button.style.setProperty('--app-accent', icon.accent || 'var(--ink)');

                // Add preview data attributes
                if (icon.previewUrl) {
                    button.setAttribute('data-preview-url', icon.previewUrl);
                }
                if (icon.previewImg) {
                    button.setAttribute('data-preview-img', icon.previewImg);
                }

                // Set preview title if preview data exists
                if (icon.previewUrl || icon.previewImg) {
                    button.setAttribute('data-preview-title', icon.label);
                }

                // Internal/External type for preview logic
                button.setAttribute('data-type', icon.type);

                button.innerHTML = `
                    <span class="icon-glyph">
                        <svg class="icon-svg" viewBox="0 0 24 24">
                            ${getIconSVG(icon.icon)}
                        </svg>
                    </span>
                    <div class="icon-meta">
                        <div class="icon-label">${icon.label}</div>
                        <div class="icon-desc">${icon.description || ''}</div>
                    </div>
                `;

                button.addEventListener('click', () => {
                    if (isMobileLayout()) {
                        openIcon(index);
                        return;
                    }
                    selectIcon(index);
                    trackEvent('icon_select', icon.label);
                });
                button.addEventListener('dblclick', () => {
                    if (!isMobileLayout()) {
                        openIcon(index);
                    }
                });
                button.addEventListener('mouseenter', () => setStatus(icon.description, { announce: false }));
                button.addEventListener('mouseleave', resetStatus);
                button.addEventListener('focus', () => setStatus(icon.description, { announce: false }));
                button.addEventListener('blur', resetStatus);

                // Split logic: first 7 icons go left, rest go right
                if (index < 8) {
                    gridLeft.appendChild(button);
                } else {
                    gridRight.appendChild(button);
                }
            });
        }

        function selectIcon(index) {
            document.querySelectorAll('.desktop-icon').forEach(icon => {
                icon.classList.remove('selected');
            });
            selectedIconIndex = index;
            const iconEl = document.querySelector(`[data-index="${index}"]`);
            iconEl.classList.add('selected');
            iconEl.focus();
            const icon = icons[index];
            if (icon && icon.description) {
                setStatus(icon.description, { announce: true });
            }
        }

        function openIcon(index) {
            const icon = icons[index];
            trackEvent('icon_open', icon.label);

            if (icon.type === 'external') {
                trackEvent('external_open', icon.label, { url: icon.url });
                window.open(icon.url, '_blank', 'noopener,noreferrer');
            } else if (icon.type === 'modal') {
                openModal(icon.content, icon.label);
            }
        }


        function getModalTitle(contentType, title) {
            if (contentType === 'about') return 'about.txt';
            if (contentType === 'contact') return 'contact';
            return title;
        }

        function openModal(contentType, title) {
            previousFocusElement = document.activeElement;

            document.getElementById('modalTitle').textContent = getModalTitle(contentType, title);
            document.getElementById('modalContent').innerHTML = getModalContent(contentType);
            document.getElementById('modalWindow').setAttribute('data-type', contentType);
            const modalIcon = document.getElementById('modalIcon');
            if (modalIcon) {
                modalIcon.innerHTML = getWindowIcon(contentType);
            }
            document.getElementById('modalOverlay').classList.add('active');
            document.body.style.overflow = 'hidden';

            trackEvent('modal_open', title);

            setTimeout(() => {
                const firstFocusable = document.querySelector('.modal-window button, .modal-window a');
                if (firstFocusable) firstFocusable.focus();
            }, 100);

            if (contentType === 'case-studies') {
                document.querySelectorAll('.case-study-item').forEach((item, index) => {
                    item.addEventListener('click', () => showCaseStudyDetail(index));
                });
            }
            if (contentType === 'build-archive') {
                document.querySelectorAll('.build-archive-item').forEach((item) => {
                    item.addEventListener('click', () => {
                        const url = item.getAttribute('data-url');
                        if (url) window.open(url, '_blank', 'noopener,noreferrer');
                    });
                });
            }

            const copyBtn = document.getElementById('copyEmailBtn');
            if (copyBtn) {
                copyBtn.addEventListener('click', () => copyText(copyBtn.getAttribute('data-copy') || ''));
            }
            const copyPhoneBtn = document.getElementById('copyPhoneBtn');
            if (copyPhoneBtn) {
                copyPhoneBtn.addEventListener('click', () => copyText(copyPhoneBtn.getAttribute('data-copy') || ''));
            }

            if (contentType === 'system-log') {
                // Trigger dynamic updates
                if (typeof fetchGitHubUpdates === 'function') {
                    fetchGitHubUpdates();
                }

                const timeInterval = setInterval(() => {
                    const timeEl = document.getElementById('timeOnPage');
                    if (timeEl) {
                        timeEl.textContent = updateTimeOnPage();
                    } else {
                        clearInterval(timeInterval);
                    }
                }, 1000);
            }
        }

        function closeModal() {
            const overlay = document.getElementById('modalOverlay');
            const windowEl = document.getElementById('modalWindow');
            overlay.classList.add('closing');
            windowEl.classList.add('closing');
            setTimeout(() => {
                overlay.classList.remove('active', 'closing');
                windowEl.classList.remove('closing');
            }, 180);
            document.body.style.overflow = '';
            currentCaseStudy = null;

            if (previousFocusElement) {
                previousFocusElement.focus();
            }
        }

        function getModalContent(type) {
            switch (type) {
                case 'case-studies':
                    return getCaseStudiesContent();
                case 'build-archive':
                    return getBuildArchiveContent();
                case 'microlifts':
                    return getMicroLiftsContent();
                case 'good-budget':
                    return getGoodBudgetContent();
                case 'weather':
                    return getWeatherContent();
                case 'about':
                    return getAboutContent();
                case 'contact':
                    return getContactContent();
                case 'system-log':
                    return getSystemLogContent();
                case 'diagnostics':
                    return getDiagnosticsContent();
                default:
                    return '';
            }
        }

        function applyTheme(theme) {
            const nextTheme = theme === 'light' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', nextTheme);
            localStorage.setItem('theme', nextTheme);
            const icon = document.getElementById('themeToggleIcon');
            if (icon) {
                icon.textContent = nextTheme === 'light' ? '' : '';
            }
            const presetKey = localStorage.getItem(`bgPreset:${nextTheme}`) || (nextTheme === 'dark' ? 'mint' : 'mint');
            applyBackgroundPreset(nextTheme, presetKey);
        }

        function applyBackgroundPreset(theme, presetKey) {
            const preset = bgPresets[theme] && bgPresets[theme][presetKey];
            if (!preset) return;
            Object.entries(preset.vars).forEach(([key, value]) => {
                document.documentElement.style.setProperty(key, value);
            });
            localStorage.setItem(`bgPreset:${theme}`, presetKey);
            renderBackgroundMenu();
        }

        function renderBackgroundMenu() {
            const container = document.getElementById('bgMenuItems');
            if (!container) return;
            const theme = document.documentElement.getAttribute('data-theme') || 'dark';
            const presetKey = localStorage.getItem(`bgPreset:${theme}`) || (theme === 'dark' ? 'mint' : 'mint');
            container.innerHTML = '';
            Object.entries(bgPresets[theme]).forEach(([key, preset]) => {
                const btn = document.createElement('button');
                btn.type = 'button';
                btn.textContent = preset.label + (key === presetKey ? ' ' : '');
                btn.setAttribute('data-action', `bg:${key}`);
                container.appendChild(btn);
            });
        }


        function initParallax() {
            let targetX = 0;
            let targetY = 0;
            let currentX = 0;
            let currentY = 0;
            let rafId = null;

            const update = () => {
                currentX += (targetX - currentX) * 0.08;
                currentY += (targetY - currentY) * 0.08;
                document.documentElement.style.setProperty('--parallax-x', `${currentX.toFixed(2)}px`);
                document.documentElement.style.setProperty('--parallax-y', `${currentY.toFixed(2)}px`);
                rafId = null;
            };

            document.addEventListener('mousemove', (e) => {
                const x = (e.clientX / window.innerWidth - 0.5) * 10;
                const y = (e.clientY / window.innerHeight - 0.5) * 10;
                targetX = x;
                targetY = y;
                if (!rafId) {
                    rafId = requestAnimationFrame(update);
                }
            }, { passive: true });
        }

        function initContextMenu() {
            const menu = document.getElementById('contextMenu');
            const desktop = document.querySelector('.desktop');
            if (!menu || !desktop) return;

            const hideMenu = () => {
                menu.classList.remove('active');
                menu.setAttribute('aria-hidden', 'true');
            };

            desktop.addEventListener('contextmenu', (e) => {
                if (e.target.closest('.desktop-icon')) return;
                e.preventDefault();
                const padding = 8;
                menu.classList.add('active');
                menu.setAttribute('aria-hidden', 'false');
                const rect = menu.getBoundingClientRect();
                const x = Math.min(e.clientX, window.innerWidth - rect.width - padding);
                const y = Math.min(e.clientY, window.innerHeight - rect.height - padding);
                menu.style.left = `${Math.max(padding, x)}px`;
                menu.style.top = `${Math.max(padding, y)}px`;
            });

            document.addEventListener('click', (e) => {
                if (!menu.contains(e.target)) {
                    hideMenu();
                }
            });

            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') hideMenu();
            });

            menu.addEventListener('click', (e) => {
                const action = e.target.getAttribute('data-action');
                if (!action) return;
                hideMenu();
                if (action === 'about') openModal('about', 'About.txt');
                if (action === 'case-studies') openModal('case-studies', 'Case Studies');
                if (action === 'contact') openModal('contact', 'Contact');
                if (action === 'toggle-theme') {
                    const current = document.documentElement.getAttribute('data-theme') || 'dark';
                    applyTheme(current === 'dark' ? 'light' : 'dark');
                }

                if (action.startsWith('bg:')) {
                    const theme = document.documentElement.getAttribute('data-theme') || 'dark';
                    const presetKey = action.replace('bg:', '');
                    applyBackgroundPreset(theme, presetKey);
                }
            });
        }

        function getWeatherContent() {
            if (!lastWeatherData) {
                return `
                    <div class="content-section">
                        <p style="opacity: 0.7;">Acquiring weather signal...</p>
                    </div>
                `;
            }

            const iconHtml = renderWeatherIcon(lastWeatherData.type);
            const condition = lastWeatherData.condition || 'Unknown';
            const temp = lastWeatherData.temp ?? '--';

            const forecastItems = (lastWeatherData.forecast || []).map(f => {
                const codeType = weatherCodeToType(f.code);
                let miniIcon = renderWeatherIcon(codeType).replace('class="weather-icon', 'class="forecast-icon');

                return `
                <div class="forecast-item">
                    <span class="forecast-time">${f.hour}:00</span>
                    ${miniIcon}
                    <span class="forecast-temp">${f.temp}</span>
                </div>
            `}).join('');

            return `
                <div class="weather-card">
                    <div class="weather-main">
                        <div class="weather-main-icon">${iconHtml}</div>
                        <div class="weather-main-temp">${temp}</div>
                        <div class="weather-main-condition">${condition}</div>
                    </div>
                
                    <div class="weather-forecast">
                        ${forecastItems || '<div style="font-size:12px;opacity:0.7;width:100%;text-align:center">Forecast unavailable</div>'}
                    </div>

                    <p style="font-size: 11px; opacity: 0.5; margin-top: 10px;">Jamestown, NY  Updated ${formatUpdatedAgo(lastWeatherData.timestamp)}</p>
                </div>
            `;
        }

        function initSelectionBox() {
            const selection = document.getElementById('selectionBox');
            const desktop = document.querySelector('.desktop');
            if (!selection || !desktop) return;
            let startX = 0;
            let startY = 0;
            let active = false;

            const updateBox = (x, y) => {
                const left = Math.min(startX, x);
                const top = Math.min(startY, y);
                const width = Math.abs(x - startX);
                const height = Math.abs(y - startY);
                selection.style.left = `${left}px`;
                selection.style.top = `${top}px`;
                selection.style.width = `${width}px`;
                selection.style.height = `${height}px`;
            };

            desktop.addEventListener('mousedown', (e) => {
                if (e.button !== 0) return;
                if (e.target.closest('.desktop-icon')) return;
                active = true;
                startX = e.clientX;
                startY = e.clientY;
                selection.classList.add('active');
                updateBox(startX, startY);
            });

            document.addEventListener('mousemove', (e) => {
                if (!active) return;
                updateBox(e.clientX, e.clientY);
            });

            document.addEventListener('mouseup', () => {
                if (!active) return;
                active = false;
                selection.classList.remove('active');
                selection.style.width = '0px';
                selection.style.height = '0px';
            });
        }

        function showBootToast() {
            const toast = document.getElementById('bootToast');
            if (!toast) return;
            const seen = sessionStorage.getItem('bootToastShown') === 'true';
            if (seen) return;
            toast.classList.add('show');
            sessionStorage.setItem('bootToastShown', 'true');
            setTimeout(() => {
                toast.classList.remove('show');
            }, 2500);
        }

        function initThemeToggle() {
            const toggle = document.getElementById('themeBtn');
            if (!toggle) return;
            toggle.addEventListener('click', () => {
                const current = document.documentElement.getAttribute('data-theme') || 'dark';
                applyTheme(current === 'dark' ? 'light' : 'dark');
            });
        }

        function showThemeHint() {
            const hint = document.getElementById('themeHint');
            const toggle = document.getElementById('themeBtn');
            if (!hint || !toggle) return;
            const seen = sessionStorage.getItem('themeHintShown') === 'true';
            if (seen) return;
            hint.classList.add('show');
            toggle.classList.add('pulse');
            sessionStorage.setItem('themeHintShown', 'true');
            setTimeout(() => {
                hint.classList.remove('show');
                toggle.classList.remove('pulse');
            }, 4000);
        }

        function openHeroIfNeeded() {
            const params = new URLSearchParams(window.location.search);
            const forceHero = params.get('hero') === '1';
            const alreadyOpened = sessionStorage.getItem('heroOpened') === 'true';
            if (forceHero || !alreadyOpened) {
                openModal('about', 'About.txt');
                sessionStorage.setItem('heroOpened', 'true');
            }
        }

        function getCaseStudiesContent() {
            return `
                <p style="margin-bottom: 24px; color: var(--ink-soft); font-size: 14px;">Selected projects demonstrating practical problem-solving with AI-assisted development.</p>
                <div class="case-study-list">
                    <div class="case-study-item" data-study="0">
                        <h4>Good Budget App</h4>
                        <p>Manual transaction tracking with a clear view of actual vs. net cash flow</p>
                    </div>
                    <div class="case-study-item" data-study="1">
                        <h4>Solana Alerts Bot</h4>
                        <p>Automated crypto wallet monitoring and notifications via Telegram</p>
                    </div>
                </div>
            `;
        }

        function getBuildArchiveContent() {
            return `
        <div class="content-section">
            <p style="margin-bottom: 24px;">A collection of experiments, side projects, and shipped apps.</p>
            <div class="build-archive-grid">
                <a href="https://tarpskunks.netlify.app/" target="_blank" rel="noopener noreferrer" class="archive-card">
                    <div class="archive-thumb">
                        <img src="./assets/previews/tarpskunks.png" alt="Tarp Skunks" loading="lazy">
                    </div>
                    <div class="archive-info">
                        <h4>Tarp Skunks Website</h4>
                        <p>Local baseball team site with schedule, fan info, and clean UI.</p>
                    </div>
                </a>
                
                <a href="https://focus-slayer.netlify.app/" target="_blank" rel="noopener noreferrer" class="archive-card">
                    <div class="archive-thumb">
                        <img src="./assets/previews/focusslayer.png" alt="Focus Slayer" loading="lazy">
                    </div>
                    <div class="archive-info">
                        <h4>Focus Slayer</h4>
                        <p>ADHD-friendly focus and productivity tool with minimal interface.</p>
                    </div>
                </a>

                <a href="https://binanceus-solana.netlify.app/" target="_blank" rel="noopener noreferrer" class="archive-card">
                    <div class="archive-thumb">
                        <img src="./assets/previews/binance-solana.png" alt="Binance.US Solana" loading="lazy">
                    </div>
                    <div class="archive-info">
                        <h4>Binance.US Solana Dashboard</h4>
                        <p>Custom dashboard for tracking Solana assets and market data.</p>
                    </div>
                </a>
            </div>
        </div>
    `;
        }

        function showCaseStudyDetail(index) {
            const studies = [
                {
                    title: 'Good Budget App',
                    problem: 'After Mint and other apps kept disconnecting, I wanted a manual way to track spending with a personalized cash-flow view that showed both actual cash and net cash (accounting for upcoming bills).',
                    built: [
                        'Manual transaction entry system with categorization',
                        'Upcoming bills tracker with "actual vs. net cash" calculation',
                        'Clean, modern UI focused on clarity over automation'
                    ],
                    tools: ['AI-assisted development', 'HTML/CSS/JS prototype', 'Local storage']
                },
                {
                    title: 'Solana Alerts Bot',
                    problem: 'I wanted automated alerts for wallet activity and price movements to reduce constant chart watching. Built as a learning prototype using n8n workflows.',
                    built: [
                        'n8n workflows for monitoring wallet transactions',
                        'Alert logic with configurable thresholds',
                        'Telegram bot integration for instant notifications'
                    ],
                    tools: ['n8n', 'Telegram API', 'Solana APIs', 'AI-assisted development']
                }
            ];

            const study = studies[index];
            const content = `
                <div class="breadcrumb">
                    <span style="cursor: pointer;" onclick="openModal('case-studies', 'Case Studies')">Case Studies</span>
                    <span class="breadcrumb-sep"></span>
                    <span>${study.title}</span>
                </div>
                <div class="case-detail">
                    <h3>${study.title}</h3>
                    <div class="content-section">
                        <h3>Problem</h3>
                        <p>${study.problem}</p>
                    </div>
                    <div class="content-section">
                        <h3>What I Built</h3>
                        <ul>
                            ${study.built.map(item => `<li><span class="bullet"></span><span>${item}</span></li>`).join('')}
                        </ul>
                    </div>
                    <div class="content-section">
                        <h3>Tools</h3>
                        <div class="tools">
                            ${study.tools.map(tool => `<span class="tool-tag">${tool}</span>`).join('')}
                        </div>
                    </div>
                    <div class="content-section">
                        <h3>Screenshots</h3>
                        <div class="screenshots">
                            <div class="screenshot-placeholder">Screenshot 1</div>
                            <div class="screenshot-placeholder">Screenshot 2</div>
                            <div class="screenshot-placeholder">Screenshot 3</div>
                            <div class="screenshot-placeholder">Screenshot 4</div>
                        </div>
                    </div>
                </div>
            `;
            document.getElementById('modalContent').innerHTML = content;
        }

        function getMicroLiftsContent() {
            return `
                <div class="content-section">
                    <p>An iOS fitness tracker I built for myself to maintain consistency with daily lifting habits. Simple, focused, and designed for clarity.</p>
                </div>
                <div class="content-section">
                    <h3>What It Is</h3>
                    <p>MicroLifts is a minimal habit tracker for strength training. It strips away the noise of complex workout apps and focuses on one thing: showing up and lifting consistently.</p>
                </div>
                <div class="content-section">
                    <h3>Why I Built It</h3>
                    <ul>
                        <li><span class="bullet"></span><span>Existing apps were cluttered with social features and gamification I didn't need</span></li>
                        <li><span class="bullet"></span><span>I wanted a simple log to track progress without overthinking</span></li>
                        <li><span class="bullet"></span><span>Building it myself meant I could design exactly the UX I wanted</span></li>
                    </ul>
                </div>
                <div class="content-section">
                    <h3>Design Philosophy</h3>
                    <p>Clean interface. Fast input. Clear progress visualization. No distractions. The app respects your time and keeps you focused on what matters: consistency.</p>
                </div>
                <div class="content-section">
                    <h3>Tech Stack</h3>
                    <div class="tools">
                        <span class="tool-tag">SwiftUI</span>
                        <span class="tool-tag">CoreData</span>
                        <span class="tool-tag">iOS 17+</span>
                        <span class="tool-tag">AI-assisted development</span>
                    </div>
                </div>
                <div class="content-section">
                    <h3>Screenshots</h3>
                    <div class="screenshots">
                        <div class="screenshot-placeholder">Home Screen</div>
                        <div class="screenshot-placeholder">Log Entry</div>
                        <div class="screenshot-placeholder">Progress View</div>
                        <div class="screenshot-placeholder">Settings</div>
                    </div>
                </div>
            `;
        }

        function getAboutContent() {
            return `
                ${aboutFullHTML}
            `;
        }

        function getGoodBudgetContent() {
            return `
                <div class="content-section">
                    <p>Demo coming soon.</p>
                </div>
            `;
        }
        function getContactContent() {
            return `
                <div class="content-section">
                    <p style="font-weight: 600; margin-bottom: 12px;">Open to roles, collaborations, and interesting problems.</p>
                    <p>I build real tools fast  web apps, dashboards, automation, and weird useful things  with a focus on clean, secure systems that actually work.</p>
                    <p>I use modern AI coding tools to turn my ideas into working products quickly, test them in the real world, and keep improving them.</p>
                    <p>I like fast iterations, clear thinking, and shipping things people actually use instead of letting them sit in meetings.</p>
                    <p>If youre building something smart and need someone who can move quickly and bring ideas to life, well get along.</p>
                </div>
                
                <div class="content-section" style="margin-top: 24px;">
                    <h3>Best way to reach me:</h3>
                    <p style="font-size: 12px; color: var(--muted); margin-bottom: 8px;">Click to reveal email </p>
                    <div id="emailContainer">
                        <button class="copy-button" onclick="revealEmail(this)">
                            Reveal Email
                        </button>
                    </div>
                </div>

                <div class="content-section" style="margin-top: 32px; padding-top: 16px; border-top: 1px solid var(--surface-border);">
                    <p style="font-size: 13px; color: var(--ink-soft);">Remote only  Based in Jamestown, NY</p>
                </div>
                <span class="copy-toast" id="copyToast">Copied</span>
            `;
        }

        function revealEmail(btn) {
            const email = 'rob@robfiasco.dev';
            const container = document.getElementById('emailContainer');
            container.innerHTML = `
                <div class="contact-links text-lg">${email}</div>
                <button class="copy-button" onclick="copyText('${email}')">
                    <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <rect x="9" y="9" width="13" height="13" rx="2" stroke-width="2"/>
                        <path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1" stroke-width="2"/>
                    </svg>
                    Copy email
                </button>
            `;
        }

        function getSystemLogContent() {
            return `
                <div class="content-section">
                    <p style="color: var(--ink-soft); margin-bottom: 16px;">Build in Public  recent updates</p>
                    <ul id="systemLogFeed">
                        <!-- Content populated by githubUpdates.js -->
                    </ul>
                </div>
                <hr class="divider">
                <p style="font-size: 12px; color: var(--ink-soft); font-style: italic;">More updates as new builds ship.</p>
            `;
        }

        function getDiagnosticsContent() {
            const events = JSON.parse(localStorage.getItem('analytics_events') || '[]');
            const recentEvents = events.slice(-20).reverse();

            return `
                <div class="diagnostics-content">
                    <p style="margin-bottom: 20px; font-family: system-ui; color: var(--ink-soft);">Last 20 analytics events (most recent first):</p>
                    ${recentEvents.map(event => `
                        <div class="diagnostics-event">
                            <div class="diagnostics-event-header">
                                <span class="diagnostics-event-name">${event.eventName}</span>
                                <span>${new Date(event.timestamp).toLocaleTimeString()}</span>
                            </div>
                            <div class="diagnostics-event-details">
                                Target: ${event.target || 'N/A'} | 
                                Device: ${event.deviceType} | 
                                Src: ${event.srcQuery || 'none'}
                            </div>
                        </div>
                    `).join('')}
                    ${recentEvents.length === 0 ? '<p style="color: var(--ink-soft);">No events logged yet.</p>' : ''}
                </div>
            `;
        }

        function copyText(value) {
            if (!value) return;
            navigator.clipboard.writeText(value).then(() => {
                const toast = document.getElementById('copyToast');
                if (!toast) return;
                toast.classList.add('show');
                setTimeout(() => {
                    toast.classList.remove('show');
                }, 1200);
            });
        }


        document.addEventListener('keydown', (e) => {

            if (e.ctrlKey && e.shiftKey && e.key === 'D') {
                e.preventDefault();
                openModal('diagnostics', 'Diagnostics');
                return;
            }

            if (e.key === 'Escape' && document.getElementById('modalOverlay').classList.contains('active')) {
                closeModal();
                return;
            }

            if (document.getElementById('modalOverlay').classList.contains('active')) return;

            if (e.key === 'ArrowDown') {
                e.preventDefault();
                if (selectedIconIndex < icons.length - 1) {
                    selectIcon(selectedIconIndex + 1);
                }
            } else if (e.key === 'ArrowUp') {
                e.preventDefault();
                if (selectedIconIndex > 0) {
                    selectIcon(selectedIconIndex - 1);
                } else if (selectedIconIndex === -1) {
                    selectIcon(0);
                }
            } else if (e.key === 'Enter' && selectedIconIndex >= 0) {
                openIcon(selectedIconIndex);
            }
        });


        document.getElementById('closeButton').addEventListener('click', closeModal);

        document.getElementById('modalOverlay').addEventListener('click', (e) => {
            if (e.target === document.getElementById('modalOverlay')) {
                closeModal();
            }
        });

        const helperTip = document.getElementById('helperTip');
        const helperClose = document.getElementById('helperClose');
        const helperDismissed = sessionStorage.getItem('helperDismissed') === 'true';

        if (helperDismissed) {
            helperTip.classList.add('hidden');
        } else {
            setTimeout(() => {
                helperTip.classList.add('hidden');
                sessionStorage.setItem('helperDismissed', 'true');
            }, 6000);
        }

        helperClose.addEventListener('click', () => {
            helperTip.classList.add('hidden');
            sessionStorage.setItem('helperDismissed', 'true');
        });

        if (typeof window !== 'undefined') {
            const params = new URLSearchParams(window.location.search);
            const src = params.get('src');
            if (src) {
                sessionStorage.setItem('src', src);
            }
        }


        const savedTheme = localStorage.getItem('theme') || 'dark';
        applyTheme(savedTheme);
        applyTimeOfDayMode();
        updateClock();
        setInterval(updateClock, 60000);
        setInterval(applyTimeOfDayMode, 300000); // Check every 5 minutes
        createIcons();
        setStatus(defaultStatusText);
        initAnalytics();
        trackEvent('page_load');
        openHeroIfNeeded();
        updateWeather();
        initWeatherUI();
        initBrandMenu();
        initParallax();
        initContextMenu();
        initSelectionBox();
        showBootToast();
        initThemeToggle();
        showThemeHint();
        initPreviewHover();
        prefetchThumbnails();
        renderBackgroundMenu();




        renderMobile();

        window.addEventListener('resize', () => {
            const isMobile = isMobileLayout();
            if (isMobile) renderMobile();
        });

        function renderMobile() {
            if (!isMobileLayout()) return;

            const mobileGrid = document.getElementById('mobileGrid');
            const mobileDock = document.getElementById('mobileDock');
            const mobileTime = document.getElementById('mobileTime');

            if (!mobileGrid || !mobileDock || mobileGrid.hasChildNodes()) {
                if (!mobileGrid || !mobileDock) return;
                mobileGrid.innerHTML = '';
                mobileDock.innerHTML = '';
            }

            const updateMobileClock = () => {
                const now = new Date();
                const hours = now.getHours();
                const minutes = String(now.getMinutes()).padStart(2, '0');
                if (mobileTime) mobileTime.textContent = `${hours}:${minutes}`;
            };
            updateMobileClock();

            const gridIds = ['lotdqq', 'cdir', 'build-archive', 'microlifts', 'case-studies', 'good-budget', 'system-log'];
            const dockIds = ['about', 'contact', 'weather'];

            gridIds.forEach(id => {
                const index = icons.findIndex(i => i.id === id);
                if (index !== -1) {
                    const el = createMobileIcon(icons[index], index);
                    mobileGrid.appendChild(el);
                }
            });

            dockIds.forEach(id => {
                const index = icons.findIndex(i => i.id === id);
                if (index !== -1) {
                    const el = createMobileIcon(icons[index], index, true);
                    mobileDock.appendChild(el);
                }
            });
        }

        function createMobileIcon(icon, index, isDock = false) {
            const btn = document.createElement('button');
            btn.className = isDock ? 'mobile-app dock-app' : 'mobile-app';
            btn.setAttribute('data-id', icon.id);
            btn.setAttribute('aria-label', icon.label);

            const svgContent = getIconSVG(icon.icon);

            btn.innerHTML = `
                <div class="mobile-app-icon" style="background: linear-gradient(180deg, ${icon.accent || 'var(--ink)'} 0%, rgba(0, 0, 0, 0.22) 100%);">
                    <svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" style="color: white;">${svgContent}</svg>
                </div>
                ${!isDock ? `<div class="mobile-app-label">${icon.label}</div>` : ''}
             `;

            btn.addEventListener('click', (e) => {
                e.stopPropagation();
                btn.firstElementChild.style.transform = 'scale(0.92)';
                setTimeout(() => btn.firstElementChild.style.transform = '', 150);

                openIcon(index);
            });

            return btn;
        }

    </script>
    <script src="assets/js/githubUpdates.js"></script>
</body>

</html>